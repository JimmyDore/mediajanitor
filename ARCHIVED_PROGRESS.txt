# Plex Dashboard - Archived Progress

Task completion logs moved from progress.txt for historical reference.

## Completed Tasks

### 2026-01-15: US-32.1 - Refresh Token Backend Implementation
- Created RefreshToken database model with:
  - id, user_id (FK), token_hash (SHA-256), expires_at, created_at
  - Unique index on token_hash for fast lookups
- Created Alembic migration for refresh_tokens table
- Updated config.py:
  - access_token_expire_minutes: 30 → 15 (short-lived)
  - Added refresh_token_expire_days: 30 (long-lived)
- Implemented auth service functions:
  - generate_refresh_token(): Cryptographically secure token generation
  - hash_refresh_token(): SHA-256 hashing (stored in DB, not the raw token)
  - create_refresh_token(): Creates and stores hashed token
  - validate_refresh_token(): Validates token exists and not expired
  - rotate_refresh_token(): Invalidates old, creates new (security best practice)
  - invalidate_refresh_token(): Deletes token by hash
  - get_user_by_id_async(): Helper for refresh endpoint
- Updated POST /api/auth/login:
  - Returns TokenWithRefresh: access_token, token_type, expires_in (900 seconds)
  - Sets refresh_token as httpOnly cookie (30 days, secure, samesite=lax)
- Created POST /api/auth/refresh:
  - Accepts refresh token via cookie or request body
  - Rotates token (old invalidated, new issued)
  - Returns new access token
- Created POST /api/auth/logout:
  - Invalidates refresh token in database
  - Clears refresh token cookie
  - Returns 204 No Content
- Updated Pydantic models:
  - TokenWithRefresh: access_token, token_type, expires_in
  - RefreshTokenRequest: optional refresh_token for non-cookie clients
- Added TESTING env var check for cookie settings (path, secure flags)
- 8 new unit tests for refresh token functionality:
  - test_refresh_success_with_cookie
  - test_refresh_without_token_returns_401
  - test_refresh_with_invalid_token_returns_401
  - test_refresh_rotates_token (verifies old token invalidated)
  - test_refresh_via_request_body
  - test_logout_success
  - test_logout_without_token_succeeds
  - test_logout_clears_cookie
- 286 backend unit tests pass, 17 integration tests pass, mypy clean
- Verified in Docker: login, refresh, rotation, logout all work correctly
- Files changed: config.py, database.py, models/user.py, routers/auth.py, services/auth.py, tests/conftest.py, tests/test_auth.py, alembic migration
- Commits:
  - feat(auth): [US-32.1] add refresh token backend implementation

### 2026-01-15: US-32.2 - Frontend Token Refresh
- Refactored auth store to use in-memory token storage instead of localStorage:
  - accessToken and tokenExpiresAt stored in module-level variables
  - Removed localStorage.getItem/setItem/removeItem for access_token
  - auth.setToken(token, expiresIn) stores token in memory with expiration
  - auth.getToken() returns current in-memory token
- Implemented refreshAccessToken() method:
  - Calls POST /api/auth/refresh with credentials: 'include' for httpOnly cookie
  - Updates in-memory token on success
  - Returns boolean for success/failure
- Implemented proactive token refresh:
  - scheduleTokenRefresh() sets timer to refresh 60 seconds before expiration
  - Timer cleared on logout or token change
- Updated logout to invalidate refresh token:
  - Calls POST /api/auth/logout endpoint
  - Clears in-memory tokens
  - Clears refresh timer
- Created authenticatedFetch() wrapper:
  - Adds Authorization header with Bearer token
  - Includes credentials: 'include' for cookies
  - On 401 response: attempts token refresh and retries original request
  - Returns original 401 response if refresh fails
- Updated all frontend pages to use authenticatedFetch:
  - +page.svelte (dashboard): syncStatus, contentSummary, triggerSync
  - settings/+page.svelte: all loadCurrentSettings and submit handlers
  - issues/+page.svelte: fetchIssues, fetchConfigStatus, all whitelist actions
  - whitelist/+page.svelte: fetchAll, removeItem
  - info/recent/+page.svelte: onMount fetch
  - info/airing/+page.svelte: onMount fetch
  - content/old-unwatched/+page.svelte: protectContent, fetchOldUnwatchedContent
- Updated login page to use credentials: 'include' and store token via auth.setToken()
- Updated theme store to use getAccessToken() instead of localStorage
- New frontend tests: 10 tests for token refresh API integration (token-refresh.test.ts)
- Updated theme.test.ts to use auth.setToken() for test setup
- 232 frontend tests pass, typecheck passes
- Verified in browser: login, navigation, API calls all work correctly
- Files changed: stores/index.ts, +page.svelte (dashboard), settings/+page.svelte, issues/+page.svelte, whitelist/+page.svelte, info/recent/+page.svelte, info/airing/+page.svelte, content/old-unwatched/+page.svelte, login/+page.svelte, theme.test.ts, token-refresh.test.ts
- Commits:
  - feat(auth): [US-32.2] add frontend token refresh implementation

### 2026-01-15: US-32.3 - Auto-Redirect on Session Expiration
- Added session expiration handling to authenticatedFetch:
  - When refresh token fails (401), clear auth state and trigger redirect
  - Redirect includes ?redirect=/original/path query param for return after login
  - Session expiration handler is registered by layout component
- Updated layout.svelte:
  - Added redirectToLogin() helper function with optional redirect path
  - Registered onSessionExpired handler showing toast "Session expired, please log in again"
  - Protected routes now redirect with original path preserved
- Updated login page:
  - Reads ?redirect query param from URL
  - After successful login, navigates to redirect path (defaults to /)
  - If already authenticated, redirect to intended destination immediately
- Frontend tests: 12 new tests for session expiration behavior (session-expiration.test.ts)
  - Tests for 401 after failed refresh triggering session expiration
  - Tests for redirect query param encoding/decoding
  - Tests for protected vs public route handling
- 244 frontend tests pass, typecheck passes
- Verified in browser: login with ?redirect=/settings correctly redirects to /settings
- Files changed: stores/index.ts, +layout.svelte, login/+page.svelte, session-expiration.test.ts, prd.json
- Commits:
  - feat(auth): [US-32.3] add auto-redirect on session expiration

### 2026-01-15: US-29.1 - Issues Table Name Column Improvements
- Refactored Issues table Name column layout for better visual alignment:
  - Changed from flexbox to CSS grid layout with fixed columns
  - Year now displays at fixed horizontal position (40px min-width, right-aligned)
  - Year uses monospace font for consistent digit alignment
  - Shows "—" when year is null (instead of hiding)
- Added title truncation with ellipsis:
  - Long titles truncate with CSS text-overflow: ellipsis
  - Native title tooltip shows full text on hover
- Added new Requester column for Unavailable tab:
  - Column header and data cells conditionally rendered when filter=requests
  - Displays username from requested_by field, or "—" if null
  - Follows same conditional pattern as Release column
- Removed inline 'by {username}' display from name cell
- Service badges now align consistently across rows (using grid auto columns)
- 244 frontend tests pass, typecheck passes
- Verified in browser: both All and Unavailable tabs display correctly
- Files changed: frontend/src/routes/issues/+page.svelte, prd.json
- Commits:
  - feat(ui): [US-29.1] improve Issues table visual alignment

### 2026-01-15: US-30.1 - Remove Currently Airing Placeholder
- Removed all currently airing placeholder code:
  - Backend: Removed GET /api/info/airing endpoint from info.py router
  - Backend: Removed get_currently_airing() function from content.py service
  - Models: Removed CurrentlyAiringItem and CurrentlyAiringResponse from content.py
  - Models: Removed currently_airing field from ContentSummaryResponse
  - Frontend: Deleted /info/airing route and page entirely
  - Frontend: Removed 'currently airing' link from dashboard info section
  - Frontend: Removed info-separator CSS class (no longer needed)
- Updated tests:
  - Backend: Removed 2 currently airing tests from test_content.py
  - Backend: Updated test_integration.py to not check for currently_airing
  - Frontend: Removed 4 currently airing tests from info.test.ts
- Dashboard info section now shows only 'recently available'
- 303 backend tests pass, mypy clean
- 241 frontend tests pass, typecheck clean
- 17 integration tests pass
- Verified: /api/info/airing returns 404
- Files changed: info.py, content.py, models/content.py, test_content.py, test_integration.py, +page.svelte (dashboard), info/airing/+page.svelte (deleted), info.test.ts
- Commits:
  - chore(cleanup): [US-30.1] remove currently airing placeholder

### 2026-01-15: US-31.1 - Recently Available Days Setting (Backend)
- Added recently_available_days field to UserSettings model (nullable Integer, default: 7)
- Created Alembic migration for new column
- Extended GET /api/settings/display to return recently_available_days
- Extended POST /api/settings/display to accept recently_available_days (range: 1-30)
- Created get_user_recently_available_days() helper function in content service
- Updated get_recently_available() to use user's setting instead of hardcoded 7 days
- Updated get_recently_available_count() to use user's setting for summary
- Invalid values return 422 with validation error
- 5 new unit tests for display preferences (recently_available_days)
- 3 new unit tests for info/recent and content/summary using user setting
- 2 new integration tests for display settings
- 294 backend unit tests pass, 19 integration tests pass, mypy clean
- Verified in Docker: GET/POST /api/settings/display with recently_available_days works
- Files changed: database.py, models/settings.py, routers/settings.py, services/content.py, test_content.py, test_integration.py, test_settings.py, alembic migration
- Commits:
  - feat(settings): [US-31.1] add recently available days setting

### 2026-01-15: US-31.2 - Recently Available Days Setting (Frontend)
- Added recentlyAvailableDays state to Settings page
- Load recently_available_days from GET /api/settings/display on mount
- Added handleRecentDaysChange() that saves on input change
- Added number input in Display section with:
  - Label: "Recently available days"
  - Help text: "Show content that became available in the past N days"
  - min=1, max=30 validation
  - Inline spinner during save
- Updated Recently Available page (/info/recent):
  - Fetch user's recently_available_days setting on mount
  - Dynamic subtitle: "Content that became available in the past {N} days"
  - Dynamic empty state message
- Frontend tests: 5 new tests for recently_available_days API integration
- 246 frontend tests pass, typecheck clean
- Verified in browser: setting at 14 days shows 8 items, subtitle shows "past 14 days"
- Files changed: settings/+page.svelte, info/recent/+page.svelte, settings-display.test.ts
- Commits:
  - feat(settings): [US-31.2] add recently available days frontend setting

### 2026-01-15: US-31.3 - User Nickname Mapping (Backend)
- Created UserNickname database model with fields:
  - id, user_id (FK), jellyseerr_username, display_name, created_at
  - UniqueConstraint on (user_id, jellyseerr_username)
- Created Alembic migration: add_user_nicknames_table
- Added Pydantic models in models/settings.py:
  - NicknameCreate: Request model for creating mappings
  - NicknameUpdate: Request model for updating display_name
  - NicknameItem: Response model for single mapping
  - NicknameListResponse: Response model for list
- Implemented service functions in services/nicknames.py:
  - create_nickname(): Creates new mapping, raises ValueError on duplicate
  - get_nicknames(): Returns all mappings for user, alphabetically sorted
  - update_nickname(): Updates display_name by ID
  - delete_nickname(): Deletes mapping by ID
- Implemented REST endpoints in routers/settings.py:
  - GET /api/settings/nicknames: List all mappings for user
  - POST /api/settings/nicknames: Create new mapping (201 Created)
  - PUT /api/settings/nicknames/{id}: Update mapping display_name
  - DELETE /api/settings/nicknames/{id}: Delete mapping
- 409 Conflict returned when trying to create duplicate username mapping
- 404 Not Found returned when updating/deleting non-existent mapping
- Empty string validation rejects jellyseerr_username="" and display_name=""
- User isolation: each user has separate namespace for mappings
- 13 unit tests in TestNicknameSettings class
- 2 integration tests for CRUD operations
- 307 backend unit tests pass, 21 integration tests pass, mypy clean
- Files changed: database.py, models/settings.py, routers/settings.py, services/nicknames.py, test_settings.py, test_integration.py, alembic migration
- Commits:
  - feat(settings): [US-31.3] add user nickname mapping backend

### 2026-01-15: US-31.4 - User Nickname Mapping (Frontend)
- Added User Nicknames section to Settings page below services configuration
- Implemented table view showing Jellyseerr Username → Display Name mappings
- Added inline add form with two inputs: jellyseerr username, display name
- Added inline edit mode for updating display names only
- Added delete confirmation mode showing "Delete this nickname?" before removal
- Implemented empty state message: "No nicknames configured. Add nicknames to customize how requesters appear in notifications."
- Added toast feedback for all CRUD operations (add, edit, delete success/error)
- Created 14 new frontend unit tests in settings-nicknames.test.ts
- Frontend typecheck passes, 260 unit tests pass
- Verified in browser: add, edit, delete, confirmation all working
- Files changed: routes/settings/+page.svelte, tests/settings-nicknames.test.ts, prd.json
- Commits:
  - feat(settings): [US-31.4] add user nickname mapping frontend

### 2026-01-15: US-31.5 - Copy Output Grouped by Requester
- Added display_name field to RecentlyAvailableItem Pydantic model
- Implemented get_nickname_map() in content service to fetch user's nickname mappings
- Implemented resolve_display_name() to resolve Jellyseerr username to display name
- Updated get_recently_available() to include resolved display_name in API response
- Updated frontend copy function to group items by requester (alphabetically)
- Items under each requester sorted by availability date (newest first)
- Items without requester grouped under 'Unknown' at the end
- Frontend table now displays display_name instead of requested_by
- Copy output format: `{display_name}:\n  - {Title} ({Type}) - available since {Date}`
- Added 4 backend tests for display_name resolution in TestRecentlyAvailableDisplayName
- Added 3 frontend tests for display_name API contract in info.test.ts
- 332 backend tests pass, 263 frontend tests pass, mypy clean, typecheck clean
- Files changed: models/content.py, services/content.py, test_content.py, info/recent/+page.svelte, info.test.ts, prd.json
- Commits:
  - feat(info): [US-31.5] copy output grouped by requester

### 2026-01-15: US-17.1 - Multi-User Watch Data Aggregation
- Implemented multi-user watch data aggregation for accurate Old/Unwatched detection
- Added aggregate_user_watch_data() function:
  - played = True if ANY user has watched
  - last_played_date = most recent date across all users
  - play_count = sum of all users' play counts
- Added fetch_jellyfin_users() to get all Jellyfin users from API
- Added fetch_user_items() to fetch items for a specific user with progress logging
- Added fetch_all_users_media() with asyncio.gather() for parallel user fetches
- Updated fetch_jellyfin_media() to use new multi-user aggregation approach
- Progress logging shows: "Fetching user 3/10: John" for each user
- 8 new tests for aggregation logic in TestMultiUserWatchDataAggregation
- 340 backend tests pass (+8 new), 21 integration tests pass, mypy clean
- Files changed: app/services/sync.py, tests/test_sync.py, prd.json
- Commits:
  - feat(sync): [US-17.1] add multi-user watch data aggregation

### 2026-01-15: US-17.2 - Sync Progress Visibility
- Added progress tracking fields to SyncStatus database model:
  - current_step: "syncing_media" or "syncing_requests"
  - total_steps: 1 or 2 (Jellyfin only, or Jellyfin + Jellyseerr)
  - current_step_progress: current user being processed
  - current_step_total: total users to process
  - current_user_name: name of current Jellyfin user
- Created Alembic migration: add_sync_progress_fields
- Added update_sync_progress() function for updating progress during sync
- Created fetch_jellyfin_media_with_progress() that processes users in batches:
  - Batch size of 3 for visible progress updates
  - Updates progress per batch with first user's name
  - Same aggregation logic as fetch_all_users_media()
- Updated run_user_sync() to use progress-aware function
- Updated GET /api/sync/status to return:
  - is_syncing: boolean flag when sync is in progress
  - progress: object with current_step, total_steps, etc.
- Updated frontend dashboard to poll every 2 seconds during sync:
  - startPolling()/stopPolling() with setInterval
  - formatProgressMessage() displays e.g. "Fetching user 3/10: John..."
  - Progress shown in header next to "Dashboard" title
  - onDestroy() cleanup stops polling
- 5 new backend unit tests in TestSyncProgressTracking
- 3 new frontend unit tests for progress API contract
- 345 backend tests pass, 266 frontend tests pass, mypy clean, typecheck clean
- Verified in browser: sync triggers correctly, rate limiting works
- Files changed: database.py, routers/sync.py, services/sync.py, test_sync.py, +page.svelte, sync.test.ts, prd.json, alembic migration
- Commits:
  - feat(sync): [US-17.2] add sync progress visibility

### 2026-01-15: US-17.3 - Fix Mobile Sidebar Visual Overlap
- Fixed sidebar showing a blue strip on mobile when closed
- Root cause: transform: translateX(-100%) only moved the element visually but didn't hide it
- Added visibility: hidden when sidebar is not open on mobile (< 768px)
- Added visibility: visible when sidebar.open class is applied
- Sidebar now completely hidden when closed, opens/closes correctly
- 266 frontend tests pass, typecheck clean
- Verified in browser: no blue strip visible, hamburger menu works
- Files changed: frontend/src/lib/components/Sidebar.svelte, prd.json
- Commits:
  - fix(ui): [US-17.3] hide mobile sidebar completely when closed

### 2026-01-15: US-19.1 - Search Issues by Text
- Added search input to Issues page header below title/stats
- Implemented debounced filtering (300ms) using setTimeout
- Search matches against:
  - Title (case-insensitive)
  - Production year
  - requested_by field (for Unavailable/Requests tab)
- Item count updates to show "X of Y items" format when search is active
- Total size updates to reflect filtered results
- Added clear (X) button that appears when search text is present
- Search operates within currently active tab filter
- CSS: search-container with search-input and search-clear button
- 24 new frontend unit tests in issues-search.test.ts
- 290 frontend tests pass, typecheck clean
- Verified in browser: search by title, year, and requester all work correctly
- Files changed: frontend/src/routes/issues/+page.svelte, frontend/tests/issues-search.test.ts, prd.json
- Commits:
  - feat(issues): [US-19.1] add search filtering for Issues page

### 2026-01-15: US-23.1 - Added Date Column on Issues Page
- Added date_created field to ContentIssueItem Pydantic model
- Updated get_content_issues() in content service to include date_created from CachedMediaItem
- Added 'Added' column to Issues table (positioned after Size column)
- Implemented formatDateCreated() function for user-friendly date display (e.g., "Jan 15, 2024")
- Added 'added' to SortField type and implemented sorting in getSortedItems()
- Added CSS styling for .col-added (12% width, right-aligned)
- Column shows "—" for request items (they have no date_created)
- Responsive: column hidden on mobile (< 768px) alongside Watched column
- 3 new frontend unit tests for date_created field handling
- 345 backend tests pass, 293 frontend tests pass, typecheck clean
- Verified in browser: column displays correctly, sorting works
- Files changed: backend/app/models/content.py, backend/app/services/content.py, frontend/src/routes/issues/+page.svelte, frontend/tests/issues.test.ts, prd.json
- Commits:
  - feat(issues): [US-23.1] add Added date column to Issues page

### 2026-01-15: US-18.1 - Show Setup Checklist for New Users
- Added Setup Checklist component to Dashboard for new user onboarding
- Checklist shows when Jellyfin not configured OR user has never synced
- Two steps displayed:
  1. "Connect Jellyfin" - links to /settings page
  2. "Run First Sync" - shows "Start Sync" button when Jellyfin is configured
- Step states with visual indicators:
  - pending: gray circle with step number
  - in-progress: blue spinner (for sync step)
  - complete: green checkmark
- Added JellyfinSettings interface and fetchJellyfinSettings() function
- Added $derived computed properties for showSetupChecklist, jellyfinStepStatus, syncStepStatus
- Checklist hides automatically when both steps are complete
- 10 new unit tests in setup-checklist.test.ts for API integration
- 303 frontend tests pass, typecheck clean
- Verified in browser: checklist shows for new users, hides for configured users
- Files changed: frontend/src/routes/+page.svelte, frontend/tests/setup-checklist.test.ts, prd.json
- Commits:
  - feat(dashboard): [US-18.1] add setup checklist for new users

### 2026-01-15: US-18.2 - Auto-Sync After Jellyfin Configuration
- Added SyncRequest Pydantic model with force: bool parameter
- Updated POST /api/sync to accept force parameter in request body
- First sync (last_sync_completed is None) bypasses rate limit when force=True
- Subsequent syncs cannot bypass rate limit even with force=True
- Settings page detects if user has never synced via GET /api/sync/status
- After first Jellyfin config + never synced, shows toast and navigates to dashboard
- Dashboard auto-triggers sync via $effect when:
  - Jellyfin configured (api_key_configured=true)
  - Never synced (last_synced=null)
  - Not currently syncing (is_syncing=false)
  - Not already triggered (autoSyncTriggered flag)
- Added 'error' state to syncStepStatus for failed syncs
- Checklist shows error state with Retry button when sync fails
- triggerSync() now accepts force parameter for first sync bypass
- 2 new backend tests for force parameter behavior
- 6 new frontend tests for auto-sync feature and error state
- 349 backend tests pass, 309 frontend tests pass, typecheck clean
- Files changed: backend/app/routers/sync.py, backend/tests/test_sync.py, frontend/src/routes/+page.svelte, frontend/src/routes/settings/+page.svelte, frontend/tests/setup-checklist.test.ts, prd.json
- Commits:
  - feat(onboarding): [US-18.2] add auto-sync after Jellyfin configuration

### 2026-01-15: US-18.3 - Optional Services Prompt
- Added dismissible "Enhance your setup" card to Dashboard
- Card shows after setup checklist complete but optional services not configured
- Fetches Jellyseerr, Radarr, Sonarr settings via API
- Displays only unconfigured services with Configure link to /settings
- Service descriptions: Jellyseerr (request tracking), Radarr (movie management), Sonarr (TV management)
- Dismiss button (X) persists state in localStorage (mediajanitor_enhance_setup_dismissed)
- Card visibility computed via showEnhanceSetup derived state
- fetchOptionalServicesSettings() fetches all three services in parallel
- loadEnhanceSetupDismissed() and dismissEnhanceSetup() handle localStorage
- 15 new tests in enhance-setup.test.ts for visibility and dismiss logic
- 324 frontend tests pass, typecheck clean
- Files changed: frontend/src/routes/+page.svelte, frontend/tests/enhance-setup.test.ts, prd.json
- Commits:
  - feat(onboarding): [US-18.3] add optional services prompt after setup

### 2026-01-15: US-20.1 - Large Season Threshold Setting
- Added large_season_size_gb field to UserSettings model (default: 15GB)
- Created Alembic migration for new column
- Updated GET/POST /api/settings/analysis endpoints to include large_season_size_gb
- Updated DELETE /api/settings/analysis to reset the new field
- Added frontend input "Flag TV series if any season exceeds" with 1-100 GB validation
- Added 5 new backend tests for large_season_size_gb (default, save, min/max validation, boundary)
- Added 2 new frontend tests for API contract
- All 352 backend tests pass, 325 frontend tests pass
- Files changed: backend/app/database.py, backend/app/models/settings.py, backend/app/routers/settings.py, backend/tests/test_settings.py, backend/alembic/versions/208afe3608f2*, frontend/src/routes/settings/+page.svelte, frontend/tests/settings-analysis.test.ts, prd.json
- Commits:
  - feat(settings): [US-20.1] add large season threshold setting

### 2026-01-15: US-20.2 - Calculate and Store Season Sizes
- Added largest_season_size_bytes field to CachedMediaItem model (nullable BigInteger)
- Created Alembic migration for new column
- Implemented fetch_series_seasons() to get seasons from Jellyfin API
- Implemented fetch_season_episodes() to get episodes with MediaSources for size calculation
- Implemented calculate_season_total_size() to sum episode sizes in a season
- Implemented calculate_season_sizes() async function that:
  - Fetches all series from user's cache
  - For each series, fetches seasons and episodes from Jellyfin API
  - Calculates total size for each season, stores largest
  - Handles API errors gracefully (logs warning, continues to next series)
- Trigger calculate_season_sizes after media sync completes
- Added calculating_sizes progress step in sync status for UI feedback
- Progress logging: "Calculating season sizes for {n} series..."
- 8 new unit tests: TestCalculateSeasonSizes and TestSyncCalculatingSizesState
- All 360 backend tests pass, 21 integration tests pass, mypy clean
- Files changed: database.py, services/sync.py, tests/test_sync.py, prd.json, alembic migration
- Commits:
  - feat(sync): [US-20.2] calculate and store season sizes

### 2026-01-15: US-20.3 - Large Series Detection Service
- Implemented is_large_series() function:
  - Returns True if largest_season_size_bytes >= threshold_gb * 1024^3
  - Returns False for movies or when largest_season_size_bytes is None
  - Default threshold: 15GB (configurable per user)
- Added large_season_size_gb to UserThresholds dataclass
- Updated get_user_thresholds() to include large_season_size_gb setting
- Updated get_content_summary() to count both large movies AND large series:
  - Changed large_movies_items to large_content_items
  - Includes both is_large_movie() and is_large_series() checks
- Updated get_item_issues() to detect large series:
  - Added elif is_large_series() check after is_large_movie()
  - Series with large seasons get 'large' badge
- Updated get_content_issues() to include largest_season_size fields:
  - Added largest_season_size_bytes (null for movies)
  - Added largest_season_size_formatted (e.g., "18.5 GB")
- Added fields to ContentIssueItem Pydantic model
- 11 new tests in TestLargeSeriesDetection class covering:
  - is_large_series() function unit tests (5 tests)
  - Content summary with large series (2 tests)
  - Content issues filter=large returns movies and series (1 test)
  - Field presence in API response (2 tests)
  - Issues badge verification (1 test)
- 371 backend tests pass (+11 new), 21 integration tests pass, mypy clean
- Files changed: models/content.py, services/content.py, tests/test_content.py, prd.json
- Commits:
  - feat(content): [US-20.3] add large series detection service

### 2026-01-15: US-20.4 - Large Content UI with Filter
- Renamed dashboard card from 'Large Movies' to 'Large Content'
- Added sub-filter buttons [All/Movies/Series] to Issues page Large tab
- Sub-filter appears only when Large tab is selected
- Default sub-filter is 'All', showing both movies and series
- Client-side filtering: no API changes needed
- Added helper functions isMovieItem(), isSeriesItem(), applyLargeSubFilter()
- Series items display "Largest season: X GB" in size column
- Movies continue to display regular file size
- Item count and total size update dynamically based on sub-filter
- Reset sub-filter to 'all' when changing tabs
- Added largest_season_size_bytes and largest_season_size_formatted to ContentIssueItem interface
- CSS: .sub-filter-nav and .sub-filter-btn styles, .size-with-label for series display
- 15 new tests in large-content.test.ts:
  - API response tests for large movies and series
  - Sub-filter logic tests (all, movies, series)
  - Size calculations with sub-filter
- 2 new tests in issues.test.ts for largest_season_size fields
- 340 frontend tests pass (+17 new), typecheck clean
- Verified in browser: sub-filter buttons work, toggle correctly, don't appear on other tabs
- Files changed: +page.svelte (dashboard), issues/+page.svelte, issues.test.ts, large-content.test.ts, prd.json
- Commits:
  - feat(ui): [US-20.4] add large content filtering UI

### 2026-01-15: US-21.1 - Slack Notification Service
- Created app/services/slack.py with async send_slack_message() function:
  - Accepts webhook_url (string) and message (dict, Slack Block Kit format)
  - Uses httpx.AsyncClient for async, non-blocking HTTP calls
  - Returns True on success (HTTP 200), False otherwise
- Graceful error handling:
  - Catches httpx.RequestError, httpx.TimeoutException, and unexpected exceptions
  - Logs warnings for all error cases (doesn't crash app)
  - Never raises exceptions - safe for fire-and-forget usage
- Added config settings for Slack webhooks:
  - slack_webhook_new_users: str = "" (optional, empty default)
  - slack_webhook_sync_failures: str = "" (optional, empty default)
  - Empty string is falsy, so callers can check `if settings.slack_webhook_*:`
- 11 unit tests covering:
  - Successful message sending (2 tests)
  - HTTP error handling with logging (1 test)
  - Network error handling (1 test)
  - Timeout handling (1 test)
  - Async non-blocking verification (1 test)
  - Block Kit format support (1 test)
  - Graceful error handling (1 test)
  - Config defaults (3 tests)
- 382 backend tests pass (+11 new), 21 integration tests pass, mypy clean
- Files changed: app/services/slack.py, app/config.py, tests/test_slack.py, prd.json
- Commits:
  - feat(notifications): [US-21.1] add Slack notification service

### 2026-01-16: US-21.2 - New User Signup Notifications
- Implemented send_signup_notification() function in auth router:
  - Creates Slack Block Kit formatted message with header and fields
  - Includes user email, user ID, signup timestamp (UTC), and total user count
  - Uses fallback text for basic Slack clients
- Added get_total_user_count() helper to count registered users
- Updated register endpoint to trigger notification via BackgroundTasks:
  - Fire-and-forget pattern: notification failures don't block registration
  - Exception handling wraps add_task() to ensure robustness
- Notification silently skipped when slack_webhook_new_users not configured
- 5 new tests in TestNewUserSignupNotifications:
  - test_signup_sends_slack_notification (verifies args passed correctly)
  - test_signup_notification_includes_total_user_count
  - test_signup_notification_is_fire_and_forget
  - test_signup_without_webhook_configured
  - test_signup_notification_uses_block_kit_format
- 387 backend tests pass (+5 new), 21 integration tests pass, mypy clean
- Files changed: app/routers/auth.py, tests/test_auth.py, prd.json
- Commits:
  - feat(notifications): [US-21.2] add new user signup notifications

### 2026-01-16: US-21.3 - Sync Failure Notifications
- Implemented send_sync_failure_notification() function in sync service:
  - Creates Slack Block Kit formatted message with header and fields
  - Includes user email, service name (Jellyfin/Jellyseerr), error message, timestamp
  - Uses fallback text for basic Slack clients
  - Truncates error message to 200 chars for readability
- Updated run_user_sync() to send notifications on failure:
  - Jellyfin sync failure triggers notification with service="Jellyfin"
  - Jellyseerr sync failure triggers notification with service="Jellyseerr"
  - Fire-and-forget pattern: notification failures don't affect sync error handling
- Added Celery sync failure notification support:
  - send_sync_failure_notification_for_celery() synchronous wrapper
  - _get_user_email() async helper to fetch user email by ID
  - sync_user task calls notification on exception
- Notification silently skipped when slack_webhook_sync_failures not configured
- 6 new tests in TestSyncFailureNotifications:
  - test_jellyfin_sync_failure_sends_notification
  - test_jellyseerr_sync_failure_sends_notification
  - test_sync_failure_notification_is_fire_and_forget
  - test_sync_failure_notification_without_webhook_configured
  - test_sync_failure_notification_uses_block_kit_format
  - test_celery_sync_user_failure_sends_notification
- 393 backend tests pass (+6 new), 21 integration tests pass, mypy clean
- Files changed: app/services/sync.py, app/tasks.py, tests/test_sync.py, prd.json
- Commits:
  - feat(notifications): [US-21.3] add sync failure notifications

### 2026-01-16: US-22.1 - Library API Endpoint
- Created GET /api/library endpoint with comprehensive filtering and sorting
- Query parameters supported:
  - type: movie, series, or all (default)
  - search: case-insensitive name search
  - watched: true, false, or all (default)
  - sort: name (default), year, size, date_added, last_watched
  - order: asc (default), desc
  - min_year, max_year: production year range filter
  - min_size_gb, max_size_gb: size range filter
- Created LibraryItem Pydantic model with fields:
  - jellyfin_id, name, media_type, production_year, size_bytes, size_formatted
  - played, last_played_date, date_created, tmdb_id
- Created LibraryResponse model with items[], total_count, total_size_bytes, total_size_formatted, service_urls
- Implemented get_library() service function in content.py
- Created app/routers/library.py with endpoint registration
- 20 unit tests in test_library.py covering all acceptance criteria
- 4 integration tests in test_integration.py for Docker verification
- 413 backend tests pass (+20 new), 25 integration tests pass (+4 new), mypy clean
- Files changed: app/main.py, app/models/content.py, app/services/content.py, app/routers/library.py (new), tests/test_library.py (new), tests/test_integration.py, prd.json
- Commits:
  - feat(api): [US-22.1] add library API endpoint

### 2026-01-16: US-22.2 - Library Page with Sub-tabs
- Created /library route with SvelteKit page component
- Added Library menu item to sidebar between Issues and Whitelist with book icon
- Implemented sub-tabs: All, Movies, Series for filtering by media type
- Table displays: Name, Year, Size, Added, Last Watched columns
- External service links: JF (Jellyfin) and TMDB badges for each item
- Server-side sorting: clicking column headers sends sort/order params to API
- Loading spinner displayed while fetching data
- Empty state with link to Settings when library is empty
- "Never" displayed in yellow for unwatched content
- 12 new unit tests in library.test.ts for API integration
- 352 frontend tests pass (+12 new), typecheck clean
- 25 integration tests pass
- Verified in browser: all tabs work, sorting works, links work
- Files changed: frontend/src/routes/library/+page.svelte (new), frontend/tests/library.test.ts (new), frontend/src/lib/components/Sidebar.svelte, prd.json
- Commits:
  - feat(ui): [US-22.2] add Library page with sub-tabs

### 2026-01-16: US-22.3 - Library Search and Filters
- Added search input in page header with 300ms debounce
- Search matches name (case-insensitive) and production year
- Added watched status filter dropdown (All/Watched/Unwatched)
- Added year range filter with min/max inputs
- Added size range filter with min/max GB inputs
- Added sort dropdown (Name/Year/Size/Date Added/Last Watched)
- Added sort order toggle button (ascending/descending)
- Added hasActiveFilters derived state for clear button visibility
- Added clearAllFilters() function to reset all filters to defaults
- Filters persist when switching between All/Movies/Series tabs
- Item count updates to show filtered results count
- Styled filters row with responsive layout for mobile
- 22 new tests in library.test.ts for filter logic
- 374 frontend tests pass, typecheck clean
- Verified in browser: search, filters, sort, clear all work correctly
- Files changed: frontend/src/routes/library/+page.svelte, frontend/tests/library.test.ts, prd.json
- Commits:
  - feat(ui): [US-22.3] add Library search and filters

### 2026-01-16: US-22.4 - Library Sorting
- Column headers (Name, Year, Size, Added, Last Watched) already implemented with toggleSort() function
- Visual arrow indicators (↑/↓) show current sort column and direction
- Click same column toggles between ascending/descending
- Default sort is Name ascending, other columns default to descending when switched
- Server-side sorting via API sort and order parameters for performance
- Added 12 new tests in library.test.ts for column header sorting
- 386 frontend tests pass, typecheck clean
- Verified in browser: clicking columns changes sort, arrows update correctly
- Files changed: frontend/tests/library.test.ts, prd.json
- Commits:
  - feat(ui): [US-22.4] add Library column header sorting

### 2026-01-16: US-24.1 - Rate Limiting on Auth Endpoints
- Created app/services/rate_limit.py with RateLimiter class:
  - In-memory storage using sliding window algorithm
  - Thread-safe with Lock for concurrent access
  - Configurable max_requests (default: 10) and window_seconds (default: 60)
  - is_rate_limited() returns (is_limited: bool, retry_after: int)
  - clear() method for testing
  - TESTING environment variable check to disable rate limiting in tests
- Global rate limiter instances: login_rate_limiter, register_rate_limiter
- Updated routers/auth.py:
  - Added _get_client_ip() helper supporting X-Forwarded-For header
  - Added _check_rate_limit() helper that raises HTTPException 429
  - Applied rate limiting to POST /api/auth/register and POST /api/auth/login
  - /api/auth/me NOT rate limited (authenticated requests only)
- HTTP 429 response includes:
  - Retry-After header with seconds until window resets
  - JSON body: {"detail": "Too many requests. Please try again in X seconds."}
- Updated integration tests to use module-scoped auth token:
  - _get_cached_token() caches token across all tests in module
  - Avoids hitting rate limit during test runs
- 9 new unit tests in test_rate_limit.py
- 426 backend unit tests pass, 25 integration tests pass, mypy clean
- Verified in Docker: 11th login request within 60 seconds returns HTTP 429 with Retry-After header
- Files changed: app/routers/auth.py, app/services/rate_limit.py, tests/test_rate_limit.py, tests/test_integration.py, prd.json
- Commits:
  - feat(auth): [US-24.1] add rate limiting on auth endpoints

### 2026-01-16: US-25.1 - Password Strength Indicator
- Added password strength indicator to registration page
- Implemented getPasswordStrength() function:
  - Returns 'weak' for 1-7 characters
  - Returns 'medium' for 8-11 characters
  - Returns 'strong' for 12+ characters
- Implemented getStrengthLabel() function for display text
- Added $derived passwordStrength that updates in real-time
- Visual indicator shows:
  - Progress bar with proportional fill (33%/66%/100%)
  - Color changes: red (weak), yellow (medium), green (success)
  - Text label next to progress bar
- Indicator only appears when password field has content
- Informational only - does NOT block form submission
- Added ARIA attributes for accessibility (role="progressbar", aria-valuenow, etc.)
- 10 new unit tests in register.test.ts:
  - getPasswordStrength() function tests for all ranges
  - Boundary tests (7→8 chars, 11→12 chars)
  - getStrengthLabel() for all levels
  - Visibility logic tests
  - Fill percentage tests
- 396 frontend tests pass (+10 new), typecheck clean
- Verified in browser: all strength levels display correctly
- Files changed: frontend/src/routes/register/+page.svelte, frontend/tests/register.test.ts, prd.json
- Commits:
  - feat(ui): [US-25.1] add password strength indicator

### 2026-01-16: US-25.2 - Password Confirmation Field
- Added confirmPassword state variable for tracking second password entry
- Added confirmPasswordError state for form validation errors
- Implemented validatePasswordsMatch() function:
  - Returns "Passwords do not match" if passwords differ
  - Returns null if passwords match
- Added passwordsMatchError derived state:
  - Only shows error when confirm field has content
  - Prevents premature error display before user starts typing
- Added isSubmitDisabled derived state:
  - Disabled when loading OR when passwords don't match (confirm has content)
  - Enabled when passwords match or confirm is empty
- Updated handleSubmit() to validate password match before API call
- Added Confirm Password input field in form:
  - Placed after Password field with strength indicator
  - Required field with placeholder "Re-enter your password"
  - Shows error styling (red border) when passwords don't match
  - Error message appears below field, not as toast
- 9 new tests in register.test.ts:
  - validatePasswordsMatch() function tests (5 tests)
  - shouldDisableSubmit() logic tests (4 tests)
- 405 frontend tests pass (+9 new), typecheck clean
- Verified in browser: error shows when passwords don't match, submit disabled
- Files changed: frontend/src/routes/register/+page.svelte, frontend/tests/register.test.ts, prd.json
- Commits:
  - feat(ui): [US-25.2] add password confirmation field

### 2026-01-16: US-26.1 - Sync Retry with Exponential Backoff
- Created app/services/retry.py with retry utility:
  - is_transient_error(): Identifies retryable errors (timeouts, 5xx, connection errors)
  - retry_with_backoff(): Async retry decorator with exponential backoff
  - MAX_RETRIES = 3 (4 total attempts)
  - INITIAL_DELAY = 1 second, doubles each retry: 1s, 2s, 4s
- Applied retry logic to Jellyfin API calls:
  - fetch_jellyfin_users(): Fetches user list
  - fetch_user_items(): Fetches items per user
  - fetch_series_seasons(): Fetches seasons for series
  - fetch_season_episodes(): Fetches episodes for seasons
- Applied retry logic to Jellyseerr API calls:
  - fetch_jellyseerr_requests(): Paginated request fetching
- Permanent errors NOT retried (401, 404, 400, 403):
  - Auth failures: 401 Unauthorized
  - Not found: 404
  - Bad request: 400
- Logging: "Retry 1/3 for Jellyfin API after 1s... (Error: TimeoutException: ...)"
- Error message after exhausted retries includes service and error type
- 21 new tests in test_retry.py:
  - TestIsTransientError: 10 tests for error classification
  - TestRetryWithBackoff: 9 tests for retry behavior
  - TestRetryConstants: 2 tests for configuration
- 7 new tests in test_sync.py TestSyncRetryWithBackoff:
  - test_fetch_jellyfin_users_retries_on_timeout
  - test_fetch_jellyfin_users_retries_on_500_error
  - test_fetch_jellyfin_users_does_not_retry_on_401
  - test_fetch_jellyfin_users_fails_after_max_retries
  - test_fetch_jellyseerr_requests_retries_on_transient_error
  - test_exponential_backoff_delays_1_2_4_seconds
  - test_successful_retry_continues_sync_normally
- 454 backend unit tests pass (+28 new), 25 integration tests pass, mypy clean
- Verified in Docker: backend starts correctly, sync works
- Files changed: app/services/retry.py (new), app/services/sync.py, tests/test_retry.py (new), tests/test_sync.py, prd.json
- Commits:
  - feat(sync): [US-26.1] add retry with exponential backoff

### 2026-01-16: US-27.1 - E2E Auth Flow Test
- Created frontend/e2e/auth-flow.spec.ts with comprehensive auth flow tests:
  - Test 1: Complete auth flow - register → login → dashboard → settings → logout
    - Uses unique timestamp email for idempotency
    - Verifies each step: registration redirect, login redirect, dashboard heading, settings page, logout redirect
  - Test 2: Protected routes redirect to login when not authenticated
    - Clears cookies and verifies /settings redirects to /login
- Fixed pre-existing E2E test failures caused by auth refactoring (US-32.2):
  - register.spec.ts: Updated for password confirmation field (US-25.2)
    - Changed getByLabel(/password/i) to getByLabel('Password', { exact: true })
    - Added test for confirm password field
  - settings.spec.ts: Replaced localStorage token mocking with real auth flow
    - Register and login before accessing settings page
  - header.spec.ts: Replaced localStorage token mocking with real auth flow
    - Register once per describe block, login in beforeEach
- 22 E2E tests pass, typecheck clean
- Files changed: e2e/auth-flow.spec.ts (new), e2e/register.spec.ts, e2e/settings.spec.ts, e2e/header.spec.ts, prd.json
- Commits:
  - test(e2e): [US-27.1] add E2E auth flow test

## 
---

# Archived from progress.txt on 2026-01-19

## 2026-01-18: US-46.4 - Update Library Page with All Service Badges

### Summary
Updated the Library page to display all 5 service badges (Jellyfin, Jellyseerr, Radarr, Sonarr, TMDB) using the ServiceBadge component. Radarr shows for movies, Sonarr shows for series.

### Files Changed
- `frontend/src/routes/library/+page.svelte` - Added sonarr_title_slug to interface, added URL functions, imported ServiceBadge, removed old CSS

### Key Implementation Details
- Added `sonarr_title_slug: string | null` to LibraryItem TypeScript interface
- Added `getJellyseerrUrl()` - uses tmdb_id + media_type
- Added `getRadarrUrl()` - uses tmdb_id (movies only)
- Added `getSonarrUrl()` - uses sonarr_title_slug (series only)
- Imported ServiceBadge component from `$lib/components/ServiceBadge.svelte`
- Replaced old text badges (JF, TMDB) with ServiceBadge components for all 5 services
- Removed ~25 lines of old `.service-badge-text.*` CSS styles

### Verification
- 661 frontend unit tests pass
- svelte-check passes (0 errors, 3 warnings - pre-existing)
- Verified in browser: Movies show Jellyfin, Jellyseerr, Radarr, TMDB badges
- Verified in browser: Series show Jellyfin, Jellyseerr, Sonarr, TMDB badges

### Learnings
- ServiceBadge component is self-contained with its own styling, no parent CSS needed
- Reuse URL generation pattern from Issues page for consistency

---

## 2026-01-18: US-46.3 - Add sonarr_title_slug to Library Backend

### Summary
Added `sonarr_title_slug` field to the Library API so that Sonarr links can be generated on the Library page for series items.

### Files Changed
- `backend/app/models/content.py` - Added `sonarr_title_slug: str | None = None` to LibraryItem model
- `backend/app/services/content.py` - Modified `get_library()` to enrich series with Sonarr titleSlug
- `backend/tests/test_library.py` - Added 2 unit tests for sonarr_title_slug behavior
- `backend/tests/test_integration.py` - Updated required fields check to include sonarr_title_slug

### Key Implementation Details
- Reused `get_sonarr_tmdb_to_slug_map()` pattern from `get_content_issues()` endpoint
- Import inside function to avoid circular imports: `from app.services.sonarr import get_sonarr_tmdb_to_slug_map, get_decrypted_sonarr_api_key`
- Build TMDB -> titleSlug map only when Sonarr is configured (has server_url and api_key_encrypted)
- Series items get titleSlug lookup via TMDB ID from ProviderIds in raw_data
- Movie items always return `sonarr_title_slug: null`

### Verification
- 571 backend tests pass (2 new tests)
- mypy typecheck passes (32 source files)
- 37 integration tests pass (updated required fields check)
- Verified in Docker with integration test

### Learnings
- When mocking functions imported inside another function, patch at the source module (e.g., `app.services.sonarr.get_sonarr_tmdb_to_slug_map`) not at the importing module

---

## 2026-01-18: US-46.2 - Update Issues Page to Use ServiceBadge Component

### Summary
Updated the Issues page to use the new ServiceBadge component, replacing text abbreviations (JF, JS, RD, SN, TMDB) with inline SVG logo icons.

### Files Changed
- `frontend/src/routes/issues/+page.svelte` - Import ServiceBadge, replace text badges, remove old CSS

### Key Implementation Details
- Imported ServiceBadge component from `$lib/components/ServiceBadge.svelte`
- Replaced 5 text badge links with ServiceBadge component calls
- Removed ~40 lines of `.service-badge-text.*` CSS styles (now in component)
- Existing URL generation functions unchanged (getJellyfinUrl, getJellyseerrUrl, etc.)
- Used nullish coalescing (`?? ''`) for type safety with potentially null URLs

### Verification
- 661 frontend unit tests pass (no new tests needed - component already tested)
- svelte-check passes (0 errors, 3 warnings - pre-existing)
- Verified in browser: all 5 service logos display as colored circular icons

### Learnings
- Component reuse reduces code duplication - removed ~40 lines of CSS from Issues page
- ServiceBadge component handles all styling internally, simplifying integration

---

## 2026-01-18: US-46.1 - Create ServiceBadge Component with Inline SVG Logos

### Summary
Created a reusable ServiceBadge component with inline SVG icons for all 5 external services: Jellyfin, Jellyseerr, Radarr, Sonarr, and TMDB.

### Files Changed
- `frontend/src/lib/components/ServiceBadge.svelte` - New component with inline SVG icons
- `frontend/tests/service-badge.test.ts` - 28 new unit tests

### Key Implementation Details
- Component accepts props: `service` (type), `url`, `title`
- Inline SVG icons are 16x16 pixels with brand colors:
  - Jellyfin: #00a4dc (blue)
  - Jellyseerr: #7b68ee (purple)
  - Radarr: #ffc230 (yellow)
  - Sonarr: #2ecc71 (green)
  - TMDB: #01b4e4 (blue)
- Links open in new tab with `target="_blank"` and `rel="noopener noreferrer"`
- Hover effect: `transform: scale(1.1)` with opacity change (0.9 → 1)
- Focus outline uses `--brand-color` CSS variable for each service
- SVG icons have `aria-hidden="true"` (decorative, title provides context)

### Verification
- 661 frontend unit tests pass (28 new tests)
- svelte-check passes (0 errors, 3 warnings - pre-existing)
- Component ready for integration in US-46.2 (Issues page) and US-46.4 (Library page)

### Learnings
- Inline SVG icons work well in both light and dark modes since they use solid fills
- Using `$derived()` for CSS variable computation keeps reactive values clean

---

## 2026-01-18: US-45.6 - Responsive Dashboard Stats Grid

### Summary
Added responsive layout to the Dashboard page, allowing the stats grid to expand on larger screens.

### Files Changed
- `frontend/src/routes/+page.svelte` - Added responsive CSS media queries for dashboard and stats grid

### Key Implementation Details
- Dashboard max-width expands at breakpoints: 800px (default) → 1000px (≥1440px) → 1200px (≥1920px)
- Stats grid gap increases proportionally: space-3 → space-4 (≥1440px) → space-5 (≥1920px)
- Stats grid remains 4 columns with cards growing larger at each breakpoint
- Mobile 2-column grid unchanged (≤640px)

### Verification
- 633 frontend unit tests pass
- svelte-check passes (0 errors, 3 warnings - pre-existing)
- Verified in browser via Puppeteer at breakpoints:
  - 800px: Default compact layout
  - 1440px: Expanded layout with max-width 1000px, larger gaps
  - 1920px: Full expansion with max-width 1200px, even larger gaps
  - 640px: Mobile 2-column grid

### Learnings
- Dashboard uses page-specific max-width values (800px → 1000px → 1200px) rather than the global --content-max-width variable since it has a more compact design
- CSS gap property in grid layouts responds well to CSS variable changes for proportional spacing

---

## 2026-01-18: US-45.5 - Responsive Table Columns on Library Page

### Summary
Added responsive column widths to the Library page table, matching the pattern from the Issues page for a consistent experience across pages.

### Files Changed
- `frontend/src/routes/library/+page.svelte` - Added responsive column styles with media queries

### Key Implementation Details
- Page max-width changed from 1000px to `var(--content-max-width)` for responsive layout
- Added `table-layout: fixed` for stable column width calculation
- Base (default): Name 40%, Year 10%, Size 12%, Added 15%, Watched 13%
- Large desktop (≥1440px): Name 44%, Year 9%, Size 10%, Added 13%, Watched 11%
- Ultrawide/4K (≥1920px): Name 48%, Year 8%, Size 9%, Added 12%, Watched 10%
- Each column has min-width values to prevent over-compression
- Mobile column hiding unchanged (Added hidden at ≤768px, Watched hidden at ≤640px)

### Verification
- 633 frontend unit tests pass
- svelte-check passes (0 errors, 3 warnings - pre-existing)
- Verified in browser via Puppeteer at breakpoints:
  - 800px: Compact layout with all visible columns fitting
  - 1440px: Expanded layout, Name column has more room
  - 1920px: Full expansion, content spreads nicely
  - 640px: Watched column hidden (mobile)
  - 768px: Added column hidden (tablet)

### Learnings
- Same pattern as Issues page (US-45.4): min-width + percentage widths with table-layout: fixed
- CSS variables from app.css (--content-max-width) enable responsive page widths

---

## 2026-01-18: US-45.4 - Responsive Table Columns on Issues Page

### Summary
Added responsive column widths to the Issues page table, allowing columns to expand at larger breakpoints for better content visibility.

### Files Changed
- `frontend/src/routes/issues/+page.svelte` - Added responsive column styles with media queries

### Key Implementation Details
- Base (default): Name column 32% (min-width 180px), other columns 10%
- Large desktop (≥1440px): Name column 38% (min-width 260px), other columns 9%
- Ultrawide/4K (≥1920px): Name column 42% (min-width 340px), other columns 8%
- Requests view: Name column expanded further (42% → 48% → 52%) since Issues column hidden
- Added `table-layout: fixed` for stable column width calculation
- Page max-width uses `var(--content-max-width)` for layout consistency
- Mobile column hiding unchanged (Size at ≤640px, Watched/Added at ≤768px)

### Verification
- 633 frontend unit tests pass
- svelte-check passes (0 errors, 3 warnings - pre-existing)
- Verified in browser via Puppeteer at breakpoints:
  - 800px: Compact layout with truncated titles
  - 1440px: Expanded layout, most titles visible
  - 1920px: Full expansion, long titles like "Spider-Man : Across the Spider-Verse" fully visible
  - 640px: Size column hidden (mobile)
  - Requests tab: Name column properly expanded (Issues column hidden)

### Learnings
- Using `table-layout: fixed` with percentage widths and min-width provides responsive columns
- Media queries at 1440px and 1920px breakpoints match the CSS variables in app.css

---

## 2026-01-18: US-45.3 - Responsive Sidebar Width

### Summary
Updated the sidebar to use CSS variables for responsive width, expanding on larger screens.

### Files Changed
- `frontend/src/lib/components/Sidebar.svelte` - Changed hardcoded 220px to var(--sidebar-width)

### Key Implementation Details
- Sidebar.svelte now uses `width: var(--sidebar-width)` instead of hardcoded `220px`
- CSS variables in app.css (from US-45.1) define the values at each breakpoint:
  - Default: 220px
  - ≥1440px: 260px
  - ≥1920px: 300px
- +layout.svelte already used `var(--sidebar-width)` for margin-left (from US-45.2)
- Mobile sidebar behavior unchanged (still 220px overlay on ≤768px)

### Verification
- 633 frontend unit tests pass
- svelte-check passes (0 errors, 3 warnings - pre-existing)
- Verified in browser via Puppeteer at breakpoints:
  - 800px viewport: sidebar = 220px
  - 1440px viewport: sidebar = 260px
  - 1920px viewport: sidebar = 300px
  - Mobile (375px): sidebar hidden, opens as 220px overlay

### Learnings
- Only one file needed to be changed since the CSS variables and layout margin-left were already in place
- The responsive layout system is modular - components just need to use the CSS variables

---

## 2026-01-18: US-45.2 - Expand Main Content Max-Width on Large Screens

### Summary
Updated the main layout to use CSS variables for responsive content width, expanding on larger screens.

### Files Changed
- `frontend/src/routes/+layout.svelte` - Changed hardcoded 1200px and 220px to CSS variables
- `frontend/src/app.css` - Added media queries to update CSS variables at breakpoints

### Key Implementation Details
- `.content { max-width: var(--content-max-width); }` instead of hardcoded 1200px
- `.app.with-sidebar { margin-left: var(--sidebar-width); }` instead of hardcoded 220px
- Media queries at 1440px and 1920px update the CSS variable values:
  - `@media (min-width: 1440px)`: content expands to 1600px
  - `@media (min-width: 1920px)`: content expands to 1800px
- Content remains centered with `margin: 0 auto`
- No horizontal scrollbar at any viewport size

### Verification
- 633 frontend unit tests pass
- svelte-check passes (0 errors, 3 warnings - pre-existing)
- Verified in browser via Puppeteer at 800px, 1200px, 1440px, 1920px viewports
- CSS variables confirmed to update at breakpoints
- Content width expands correctly without overflow

### Learnings
- CSS variables in :root can be updated via media queries, making responsive layouts more maintainable
- The same media query updates both content-max-width and sidebar-width for consistency

---

## 2026-01-18: US-45.1 - Add CSS Breakpoints and Variables for Large Screens

### Summary
Added CSS custom properties for large screen breakpoints and responsive layout values to enable progressive layout expansion on larger displays.

### Files Changed
- `frontend/src/app.css` - Added responsive layout system with breakpoints and variables

### Key Implementation Details
- Added breakpoint variables: `--breakpoint-lg: 1440px`, `--breakpoint-xl: 1920px`
- Added sidebar width variables: 220px (default), 260px (lg), 300px (xl)
- Added content max-width variables: 1200px (default), 1600px (lg), 1800px (xl)
- Documented breakpoint strategy in CSS comments explaining mobile-first approach
- Note: CSS media queries cannot use var() directly, so breakpoint values must be hardcoded in @media rules

### Verification
- 633 frontend unit tests pass
- svelte-check passes (0 errors, 3 warnings - pre-existing)
- Variables verified in browser DevTools via Puppeteer

### Learnings
- CSS custom properties are defined in :root but media query thresholds must use literal values
- Breakpoint variables serve as documentation and reference for consistent values across media queries

---

## 2026-01-18: US-44.7 - Change Password in Settings

### Summary
Added change password functionality to settings. Users can now update their password from a new Security settings page without going through password reset.

### Files Changed
- `backend/app/models/user.py` - Added ChangePasswordRequest/ChangePasswordResponse Pydantic models
- `backend/app/routers/auth.py` - Added POST /api/auth/change-password endpoint
- `backend/tests/test_password_reset.py` - Added 10 new unit tests for change password
- `backend/tests/test_integration.py` - Added 3 integration tests for change password
- `frontend/src/routes/settings/+layout.svelte` - Added Security nav item with lock icon
- `frontend/src/routes/settings/security/+page.svelte` - New security settings page
- `frontend/tests/settings-security.test.ts` - New test file with 17 unit tests

### Key Implementation Details
- POST /api/auth/change-password endpoint requires authentication
- Verifies current password with bcrypt before allowing change
- New password validated via Pydantic: 8+ chars, uppercase, lowercase, number
- Returns 200 on success, 400 if current password wrong, 422 for weak password
- Security settings page has three password inputs with show/hide toggles
- Client-side validation matches backend requirements with real-time feedback
- Confirm password field ensures passwords match before submission

### Verification
- 37 password reset tests pass (10 new change password tests)
- mypy typecheck passes (32 source files)
- svelte-check passes (0 errors, 3 warnings pre-existing)
- 12 auth integration tests pass (3 new change password tests)
- Verified in browser: Security page displays with all inputs and Change Password button

### Learnings
- Reuse existing auth service functions (hash_password, verify_password) for password change
- Client-side password validation should mirror backend requirements for good UX
- Settings sub-pages can be added by creating new directory in routes/settings/

---

## 2026-01-18: US-44.6 - Reset Password UI

### Summary
Created the reset password page with password reset form. Users can enter a new password after clicking a reset link from email.

### Files Changed
- `frontend/src/routes/reset-password/+page.svelte` - New reset password page
- `frontend/src/routes/+layout.svelte` - Added /reset-password to publicRoutes
- `frontend/tests/reset-password.test.ts` - 19 new unit tests

### Key Implementation Details
- Page reads token from URL query param: `/reset-password?token=abc123`
- Shows "Invalid reset link. No token provided." if no token in URL
- Two password inputs with show/hide toggle (eye icons)
- Client-side validation: 8+ chars, uppercase, lowercase, number required
- Validates passwords match before submission (real-time feedback)
- Calls POST /api/auth/reset-password with token and new password
- On success: shows green checkmark message, redirects to /login after 2 seconds
- On 400 error: shows "Invalid or expired token. Please request a new reset link."
- Added /reset-password to publicRoutes for unauthenticated access

### Verification
- 616 frontend unit tests pass (19 new tests)
- svelte-check passes (0 errors, 3 warnings - pre-existing)
- Verified in browser: page renders correctly
- Verified in browser: no token shows error message
- Verified in browser: password toggle shows/hides text
- Verified in browser: password mismatch validation works
- Verified in browser: invalid token shows error

### Learnings
- Password show/hide toggle uses type="text" vs type="password" toggle
- SVG eye icon changes to eye-off when password is visible
- Client-side password validation should match backend requirements

---

## 2026-01-18: US-44.5 - Forgot Password UI

### Summary
Created the forgot password page with email form to allow users to request a password reset link.

### Files Changed
- `frontend/src/routes/forgot-password/+page.svelte` - New forgot password page
- `frontend/src/routes/login/+page.svelte` - Added "Forgot password?" link
- `frontend/src/routes/+layout.svelte` - Added /forgot-password to publicRoutes
- `frontend/tests/forgot-password.test.ts` - 9 new unit tests

### Key Implementation Details
- Page has email input, "Send Reset Link" button, and "Back to login" link
- On submit: calls POST /api/auth/request-password-reset
- Success state shows green checkmark with message: "If that email exists, a reset link has been sent. Check your inbox."
- Error state shows error message in red box
- Button disabled while request is in flight
- Added /forgot-password to publicRoutes so unauthenticated users can access it
- Styling matches existing auth pages (login, register)

### Verification
- 597 frontend unit tests pass (9 new tests)
- svelte-check passes (0 errors, 3 warnings - pre-existing)
- Verified in browser: page renders correctly
- Verified in browser: form submission shows success message

### Learnings
- New routes need to be added to publicRoutes in +layout.svelte for unauthenticated access
- Docker containers need to be rebuilt with --no-cache for new routes to be picked up

---

## 2026-01-18: US-43.2 - Fix Warning Color for WCAG AA Compliance

### Summary
Fixed warning colors to meet WCAG AA contrast requirements (4.5:1 for normal text).

### Files Changed
- `frontend/src/app.css` - Updated `--warning` and `--warning-light` colors for light mode
- `frontend/src/lib/components/Toast.svelte` - Changed toast-warning text color to dark amber

### Key Implementation Details
- **Light mode `--warning`**: Changed from `#ca8a04` (2.9:1) to `#a16207` (5.5:1)
- **Light mode `--warning-light`**: Updated rgba() to match new base color
- **Toast warning text**: Changed from `white` to `#451a03` (dark amber) for proper contrast
- **Dark mode unchanged**: `#eab308` already passes WCAG AA (9.3:1 on dark backgrounds)

### Updated Contrast Ratios (WCAG AA = 4.5:1)

| Scenario | Foreground | Background | Contrast | WCAG AA |
|----------|------------|------------|----------|---------|
| Light mode: warning text on white bg | #a16207 | #ffffff | **5.5:1** | ✅ PASS |
| Light mode: dark text on warning toast | #451a03 | #a16207 | **5.5:1** | ✅ PASS |
| Dark mode: warning text on dark bg | #eab308 | #0f172a | **9.3:1** | ✅ PASS |
| Dark mode: dark text on warning toast | #451a03 | #eab308 | **7.8:1** | ✅ PASS |

### Verification
- 588 frontend unit tests pass
- svelte-check passes (0 errors, 3 warnings - pre-existing)
- Verified in browser: Issues page "Never" text is readable in light mode
- Verified in browser: Library page "Never" text is readable in light mode
- Verified in browser: Settings/Users warning badges are visible in light mode

### Learnings
- WCAG AA requires 4.5:1 contrast for normal text
- Yellow/amber colors are inherently high luminance, requiring darker shades for accessibility
- Toast components with amber backgrounds work better with dark text than white text
- Color `#a16207` (amber-700) maintains visual recognition as amber while meeting contrast requirements

---

## 2026-01-18: US-43.1 - Audit Warning Color Contrast

### Summary
Performed comprehensive WCAG AA contrast audit of warning color usage across the application using contrastchecker.com.

### Contrast Audit Results

| Scenario | Foreground | Background | Contrast | WCAG AA |
|----------|------------|------------|----------|---------|
| Light mode: warning text on white bg | #ca8a04 | #ffffff | **2.94:1** | ❌ FAIL |
| Light mode: warning text on warning-light bg | #ca8a04 | ~#faf3e6 | **2.66:1** | ❌ FAIL |
| Light mode: white text on warning toast bg | #ffffff | #ca8a04 | **2.94:1** | ❌ FAIL |
| Dark mode: warning text on dark bg | #eab308 | #0f172a | **9.31:1** | ✅ PASS |
| Dark mode: warning text on warning-light bg | #eab308 | ~#302e25 | **7.1:1** | ✅ PASS |
| Dark mode: white text on warning toast bg | #ffffff | #eab308 | **1.92:1** | ❌ FAIL |

### Files Using `var(--warning)` That Need Testing
1. `frontend/src/routes/issues/+page.svelte` - `.missing-seasons`, `.badge-large`, `.col-release.future`, `.col-watched.never`
2. `frontend/src/routes/library/+page.svelte` - `.col-watched.never`
3. `frontend/src/routes/content/old-unwatched/+page.svelte` - `.col-status.never-watched`
4. `frontend/src/routes/register/+page.svelte` - `.strength-medium`, `.strength-text-medium`
5. `frontend/src/routes/settings/users/+page.svelte` - Warning badge (!)
6. `frontend/src/lib/components/Toast.svelte` - `.toast-warning`
7. `frontend/src/app.css` - `.badge-warning` global class

### Key Findings
- **Light mode warning color (#ca8a04) fails WCAG AA** on all backgrounds (< 3:1 contrast)
- **Dark mode warning color (#eab308) passes WCAG AA** on dark backgrounds (7-9:1 contrast)
- **Toast warning fails in BOTH modes** because white text on bright yellow/amber doesn't have enough contrast
- The fix (US-43.2) will need to darken the light mode warning color while keeping it recognizable as amber

### Verification
- 588 frontend unit tests pass
- svelte-check passes (0 errors, 3 warnings - pre-existing)
- Contrast ratios documented using contrastchecker.com

### Learnings
- WCAG AA requires 4.5:1 contrast for normal text
- Yellow/amber colors are inherently difficult for accessibility due to high luminance
- Dark text on warning-light backgrounds is even worse than warning text on white
- Toast components need special consideration - the warning toast pattern (white on amber) is problematic

---

## 2026-01-18: US-42.3 - Use SearchInput in Issues Page

### Summary
Replaced the inline search input in Issues page with the reusable SearchInput component for improved accessibility.

### Files Changed
- `frontend/src/routes/issues/+page.svelte` - Imported SearchInput component, replaced inline HTML, removed duplicated CSS

### Key Implementation Details
- Imported `SearchInput` component from `$lib/components/SearchInput.svelte`
- Replaced inline `<div class="search-container">...<input>...</div>` with `<SearchInput>` component
- Set `aria-label="Search issues by title or year"` for screen reader accessibility
- Passed existing props: `value={searchQuery}`, `placeholder`, `oninput={handleSearchInput}`, `onclear={clearSearch}`
- Removed ~53 lines of duplicated CSS for `.search-container`, `.search-input`, `.search-clear`

### Verification
- 588 frontend unit tests pass
- svelte-check passes (0 errors, 3 warnings - pre-existing)
- Verified in browser: search input renders correctly with aria-label
- Verified: debounced search filtering works (1 of 214 items when searching "Malcolm")
- Verified: clear button appears and clears search correctly

### Learnings
- The SearchInput component handles its own styling, so duplicated CSS in parent pages should be removed
- Same pattern as US-42.2 (Library page) - consistent approach across pages

---

## 2026-01-18: US-42.2 - Use SearchInput in Library Page

### Summary
Replaced the inline search input in Library page with the reusable SearchInput component for improved accessibility.

### Files Changed
- `frontend/src/routes/library/+page.svelte` - Imported SearchInput component, replaced inline HTML, removed duplicated CSS

### Key Implementation Details
- Imported `SearchInput` component from `$lib/components/SearchInput.svelte`
- Replaced inline `<div class="search-container">...<input>...</div>` with `<SearchInput>` component
- Set `aria-label="Search library by title or year"` for screen reader accessibility
- Passed existing props: `value={searchQuery}`, `placeholder`, `oninput={handleSearchInput}`, `onclear={clearSearch}`
- Removed ~46 lines of duplicated CSS for `.search-container`, `.search-input`, `.search-clear`

### Verification
- 588 frontend unit tests pass
- svelte-check passes (0 errors, 3 warnings - pre-existing)
- Verified in browser: search input renders correctly with aria-label
- Verified: debounced search filtering works
- Verified: clear button appears and clears search correctly

### Learnings
- The SearchInput component handles its own styling, so duplicated CSS in parent pages should be removed
- Docker rebuild required for production verification after component changes

---

## 2026-01-18: US-42.1 - Create SearchInput Component

### Summary
Created a reusable SearchInput component with built-in accessibility for consistent search inputs across the app.

### Files Changed
- `frontend/src/lib/components/SearchInput.svelte` - New component file
- `frontend/tests/search-input.test.ts` - New test file with 19 unit tests

### Key Implementation Details
- Props interface: `value`, `placeholder`, `aria-label`, `oninput`, `onclear`
- Input has `type="text"` and `class="search-input"`
- `aria-label` applied to input element for screen reader accessibility
- Clear button appears when value is not empty with `aria-label="Clear search"`
- Same HTML structure (`div.search-container` > `input.search-input` + `button.search-clear`)
- Same CSS classes and styles as existing search inputs in library/issues pages

### Verification
- 588 frontend unit tests pass (19 new tests)
- svelte-check passes (0 errors, 3 warnings - pre-existing)
- Component compiles correctly and is ready for integration in US-42.2 and US-42.3

### Learnings
- Svelte 5 uses `$props()` rune for prop definitions with TypeScript interface
- The `aria-label` prop must use bracket notation in interface due to hyphen

---

## 2026-01-18: US-41.3 - Auto-Focus and Restore Focus

### Summary
Implemented auto-focus when modals open and focus restoration when modals close for improved keyboard accessibility. Duration picker focuses first radio input, delete modal focuses Cancel button (safer default for destructive actions).

### Files Changed
- `frontend/src/routes/issues/+page.svelte` - Added trigger refs, capture/restore focus logic, $effect hooks for auto-focus
- `frontend/tests/issues-auto-focus.test.ts` - New test file with 24 unit tests

### Key Implementation Details
- Added `durationPickerTrigger` and `deleteModalTrigger` state refs to store trigger elements
- `openDurationPicker()` and `openDeleteModal()` capture `document.activeElement` before opening
- `closeDurationPicker()` and `closeDeleteModal()` call `trigger.focus()` to restore focus
- Added `$effect` hooks that fire when modal state changes:
  - Duration picker: focuses first radio input (Permanent option)
  - Delete modal: focuses Cancel button (safer default for destructive action)
- Added `onkeydown={handleKeydown}` and `tabindex="-1"` to modal overlays
- Kept `svelte-ignore a11y_click_events_have_key_events` for overlay backdrop (role="presentation" is correct semantic)

### Verification
- svelte-check passes (0 errors, 3 warnings - all pre-existing in other files)
- Verified in browser using Puppeteer:
  - Duration picker: first radio input (value="permanent") receives focus
  - Delete modal: Cancel button receives focus
  - Focus returns to trigger button after closing via Escape, Cancel, or Confirm

### Learnings
- Use `$effect` for side effects that depend on reactive state (like auto-focusing when modal opens)
- Capture `document.activeElement` BEFORE any state changes that might move focus
- For destructive actions, focusing Cancel button is the safer default
- Modal overlays with `role="presentation"` don't need interactive roles (they're visual backdrops)

---

## 2026-01-18: US-41.2 - Implement Keyboard Focus Trap

### Summary
Implemented keyboard focus trap for modal dialogs on the Issues page. Tab and Shift+Tab now cycle through focusable elements within the modal without escaping to background content.

### Files Changed
- `frontend/src/routes/issues/+page.svelte` - Added getFocusableElements() helper, updated handleKeydown() for focus trap, added modal element refs, added tabindex="0" to modals
- `frontend/tests/issues-focus-trap.test.ts` - New test file with 14 unit tests

### Key Implementation Details
- Added `getFocusableElements()` helper function to find all interactive elements (buttons, inputs, selects) within a container
- Extended `handleKeydown()` to handle Tab/Shift+Tab key presses
- Tab from last focusable element wraps to first element
- Shift+Tab from first focusable element wraps to last element
- Added `bind:this` to capture modal element references for focus trap logic
- Added `tabindex="0"` to modal containers for accessibility compliance
- Removed `svelte-ignore a11y_interactive_supports_focus` comments (no longer needed with tabindex)
- Focus trap works for both duration picker modal (7 focusable elements) and delete modal (4 focusable elements)

### Verification
- 552 frontend unit tests pass (14 new tests)
- svelte-check passes (0 errors, 3 warnings - pre-existing)
- Verified in browser using Puppeteer:
  - Duration picker: Tab from Confirm wraps to first radio input
  - Duration picker: Shift+Tab from first radio wraps to Confirm button
  - Delete modal: Tab from Delete wraps to first checkbox
  - Both modals have tabindex="0" attribute

### Learnings
- Focus trap pattern: get focusable elements, track current index, wrap at boundaries
- Use `document.activeElement` to determine current focused element
- Use `event.preventDefault()` to stop browser's default Tab behavior before programmatically moving focus
- `tabindex="0"` on modal container makes it focusable and satisfies a11y_interactive_supports_focus warning

---

## 2026-01-18: US-41.1 - Add Escape Key to Close Modals

### Summary
Added Escape key support to close modal dialogs on the Issues page for improved keyboard accessibility.

### Files Changed
- `frontend/src/routes/issues/+page.svelte` - Added handleKeydown() function and svelte:window keydown handler
- `frontend/tests/issues-modal-keyboard.test.ts` - New test file with 8 unit tests

### Key Implementation Details
- Added `handleKeydown()` function that checks for Escape key press
- Uses `svelte:window onkeydown={handleKeydown}` to listen for keyboard events globally
- Closes duration picker modal first if open, otherwise closes delete confirmation modal
- Escape key acts like Cancel button (no destructive action triggered)
- The keydown handler is always active but only responds when a modal is open

### Verification
- 538 frontend unit tests pass (8 new tests)
- svelte-check passes (0 errors, 3 warnings - pre-existing)
- Verified in browser using Puppeteer:
  - Duration picker modal opens, Escape closes it
  - Delete confirmation modal opens, Escape closes it without deleting

### Learnings
- `svelte:window onkeydown={handler}` is the Svelte 5 way to listen for global keyboard events
- No need to add/remove event listeners manually - Svelte handles cleanup
- Checking `showDurationPicker` before `showDeleteModal` ensures the topmost modal closes first

---

## 2026-01-18: US-40.1 - Fix GitHub Repository Link

### Summary
Updated the Help page to link to the correct project repository (jimmydore/mediajanitor) instead of the placeholder link.

### Files Changed
- `frontend/src/routes/help/+page.svelte` - Updated contact section links

### Key Implementation Details
- Changed from single "GitHub Issues" link to anthropics/claude-code
- Now has two links: "view the project on GitHub" and "report an issue"
- Both point to `https://github.com/jimmydore/mediajanitor` and `https://github.com/jimmydore/mediajanitor/issues`
- Links have `target="_blank"` and `rel="noopener noreferrer"` for security

### Verification
- 530 frontend unit tests pass
- svelte-check passes (0 errors, 3 warnings - pre-existing)
- Verified in browser: links display correctly and have correct href attributes

---

## 2026-01-18: US-39.2 - Add Type Icons to Toasts

### Summary
Added type-specific icons to toast notifications for visual clarity. Success toasts show a checkmark, error toasts show an X, info toasts show an i-circle, and warning toasts show a triangle.

### Files Changed
- `frontend/src/lib/components/Toast.svelte` - Added inline SVG icons for each toast type, added warning toast type
- `frontend/tests/toast.test.ts` - Added 9 new tests for icon functionality

### Key Implementation Details
- Icons are inline SVGs (18x18px) positioned left of message text
- Success: checkmark (M3.5 9.5l4 4 7-8)
- Error: X shape (M4 4l10 10M14 4L4 14)
- Info: i inside circle
- Warning: exclamation inside triangle
- Icons use `stroke="currentColor"` to inherit white text color from toast
- Icon container has `aria-hidden="true"` (decorative, message text conveys meaning)
- Added new `warning` toast type with `--warning` amber background

### Verification
- 530 frontend unit tests pass (9 new tests)
- svelte-check passes (0 errors, 3 warnings - all pre-existing)
- Verified in browser: success toast shows checkmark icon, positioned left of message

### Learnings
- Inline SVGs are more maintainable than external icon libraries for small icon sets
- Using `currentColor` for stroke allows icons to inherit text color from parent

---

## 2026-01-18: US-38.3 - Recently Available Uses Language Preference

### Summary
Implemented language preference support for the Recently Available page. Users can now choose to view and copy content titles in French instead of English.

### Files Changed
- `backend/app/models/content.py` - Added `title_fr` field to `RecentlyAvailableItem` model
- `backend/app/services/content.py` - Return `title_fr` from database in API response
- `frontend/src/routes/info/recent/+page.svelte` - Read `title_language` preference, display titles based on preference, update copy function
- `frontend/tests/info.test.ts` - Added 6 new tests for title_fr field and language preference logic

### Key Implementation Details
- `RecentlyAvailableItem` now includes `title_fr: str | None` field
- Frontend reads `title_language` from `/api/settings/display` on page load
- `getDisplayTitle()` helper returns French title if `titleLanguage === 'fr'` and `title_fr` is available
- Falls back to English title when French title is null/unavailable
- Copy button also uses `getDisplayTitle()` to output titles in preferred language

### Verification
- 556 backend tests pass
- 493 frontend tests pass (6 new tests)
- mypy typecheck passes
- svelte-check passes (0 errors)
- 34 integration tests pass
- Verified in browser: titles switch between English and French based on setting

### Learnings
- The `title_fr` field was already populated during sync (US-38.2), so only API and frontend changes needed
- French title fallback to English happens in the frontend, not the backend

---

## 2026-01-18: US-37.2 - Display Prefilled Users in UI

### Summary
Verified that the display prefilled users feature was already fully implemented in US-36.4 and US-37.1. No code changes needed - just marked the story as complete.

### Existing Implementation
- `frontend/src/routes/settings/users/+page.svelte` - Users page displays prefilled Jellyfin users
- Warning badge (!) next to usernames with `has_jellyseerr_account=false`
- Tooltip explains: "This Jellyfin user was not found in Jellyseerr. They may not be able to request content."
- Empty display names show em-dash (—)
- Edit/delete functionality preserved

### Verification
- 487 frontend unit tests pass (16 for settings-users.test.ts)
- svelte-check passes (0 errors, 3 warnings)
- Verified in browser via Puppeteer: users table shows prefilled Jellyfin users with warning badges

### Key Implementation Details (Pre-existing)
- `has_jellyseerr_account` field added in US-37.1 backend sync
- Warning badge rendered with `{#if nickname.has_jellyseerr_account === false}`
- Empty state only shows when `nicknames.length === 0 && !showAddNicknameForm`

### Learnings
- Before implementing, always check if the feature is already complete by reviewing existing code
- The warning badge styling uses `--warning-light` background with `--warning` text color

---

## 2026-01-16: US-35.1 - Fix Watched Column Sort Order

### Summary
Fixed the Watched column sorting to properly handle three different states: items with dates, items marked as "Watched" (no date), and items marked as "Never" (never watched).

### Files Changed
- `frontend/src/routes/issues/+page.svelte` - Added 'watched' to SortField type, implemented three-tier sorting logic, updated column header
- `frontend/tests/issues-sorting.test.ts` - New test file for watched column sorting logic

### Key Implementation Details
- Added `watched` to the `SortField` type union
- Implemented three-tier priority system: 1 = has date, 2 = played without date, 3 = never watched
- Descending order (first click): dates DESC → "Watched" → "Never"
- Ascending order (second click): "Never" → "Watched" → dates ASC
- Column header now uses 'watched' field for non-requests tabs (uses 'date' for Requested column)
- Sorting works for both movies and series

### Verification
- 423 frontend unit tests pass (12 new sorting tests)
- svelte-check passes (0 errors)
- Verified in browser using Puppeteer: clicking Watched column sorts correctly in both directions

---

## 2026-01-16: US-34.3 - Add Sorting to Requester and Release Columns

### Summary
Added sorting functionality to Requester and Release columns on the Unavailable tab of the Issues page.

### Files Changed
- `frontend/src/routes/issues/+page.svelte` - Added 'requester' and 'release' to SortField type, sorting logic, and clickable column headers

### Key Implementation Details
- Added `requester` and `release` to the `SortField` type union
- Implemented `requester` sorting: alphabetical comparison with nulls sorted last
- Implemented `release` sorting: date comparison with nulls sorted last
- Wrapped Requester and Release column headers with sort buttons
- Sort indicators (↑/↓) appear on active sort column
- Both columns default to descending order when first clicked

### Verification
- 411 frontend unit tests pass
- svelte-check passes (0 errors)
- Verified in browser using Puppeteer: both columns sort correctly in asc/desc order

---

## 2026-01-16: US-34.2 - Normalize Table Header Casing

### Summary
Changed table headers from ALL CAPS to Title Case for a more professional appearance.

### Files Changed
- `frontend/src/routes/issues/+page.svelte` - Removed text-transform: uppercase from table header CSS

### Key Implementation Details
- Removed `text-transform: uppercase` and `letter-spacing: 0.05em` from `.issues-table th` CSS rule
- Headers now display as written in HTML: Name, Requester, Issues, Size, Added, Release, Requested/Watched
- Badge text (OLD, LANGUAGE, etc.) still uses uppercase via separate `.badge` CSS rule

### Verification
- 411 frontend unit tests pass
- svelte-check passes (0 errors)
- Verified in Docker: all headers display in Title Case

---

## 2026-01-16: US-34.1 - Hide Issues Column on Unavailable Tab

### Summary
Hid the Issues column on the Unavailable tab to give more space to the content name column.

### Files Changed
- `frontend/src/routes/issues/+page.svelte` - Added conditional rendering for Issues column and CSS for expanded Name column

### Key Implementation Details
- Added `{#if activeFilter !== 'requests'}` around Issues column header and cells
- Added `class:requests-view={activeFilter === 'requests'}` to table element
- Added CSS rule `.requests-view .col-name { width: 45%; }` to expand Name column
- Other tabs (All, Old, Large, Language) still show the Issues column at 35% width

### Verification
- 411 frontend unit tests pass
- svelte-check passes (0 errors)
- Verified in browser: Unavailable tab has no Issues column, Name column is wider
- Verified in browser: All/Old tabs still show Issues column

---

## 2026-01-16: US-44.4 - Reset Password Endpoint

### Summary
Created POST /api/auth/reset-password endpoint that allows users to submit a new password using a valid reset token.

### Files Changed
- `backend/app/models/user.py` - Added `ResetPasswordRequest`, `ResetPasswordResponse` models and `validate_password_strength()` function
- `backend/app/routers/auth.py` - Added `reset_password` endpoint
- `backend/tests/test_password_reset.py` - Added 11 new unit tests (TestResetPasswordEndpoint class)
- `backend/tests/test_integration.py` - Added 3 integration tests for reset-password validation

### Key Implementation Details
- Password validation with Pydantic `field_validator`: 8+ chars, uppercase, lowercase, number
- Iterates through all non-expired, unused tokens and compares bcrypt hashes
- Updates user's `hashed_password` with new bcrypt hash
- Marks token as `used=True` to prevent reuse
- Returns 200 OK with success message on valid reset
- Returns 400 Bad Request for invalid/expired/used tokens
- Returns 422 Unprocessable Entity for weak passwords (validation)

### Verification
- 547 backend tests pass (11 new tests)
- mypy typecheck passes
- 9 auth integration tests pass in Docker

### Learnings
- Pydantic `field_validator` decorator runs during request parsing, catching validation errors before endpoint code
- bcrypt.checkpw is used to safely compare incoming token with stored hashes

---

## 2026-01-16: US-44.3 - Request Password Reset Endpoint

### Summary
Created POST /api/auth/request-password-reset endpoint that allows users to request a password reset email.

### Files Changed
- `backend/app/models/user.py` - Added `PasswordResetRequest` and `PasswordResetResponse` Pydantic models
- `backend/app/routers/auth.py` - Added `request_password_reset` endpoint and `_check_password_reset_rate_limit` helper
- `backend/app/services/rate_limit.py` - Added `password_reset_rate_limiter` (3 requests/email/hour)
- `backend/tests/test_password_reset.py` - Added 10 new unit tests for endpoint and rate limiting
- `backend/tests/test_integration.py` - Added 3 integration tests for password reset endpoint

### Key Implementation Details
- Generates secure random token: `secrets.token_urlsafe(32)` (32 bytes, URL-safe base64)
- Hashes token with bcrypt before storage for security
- Token expires in 15 minutes from creation
- Deletes existing unused tokens for user before creating new one (only one active reset per user)
- Sends email via `send_password_reset_email()` service with reset URL
- Returns 200 OK even for non-existent emails (prevents email enumeration attacks)
- Rate limited to 3 requests per email per hour (in-memory RateLimiter keyed by email)

### Verification
- 533 backend tests pass (10 new tests + 3 integration tests)
- mypy typecheck passes
- 31 integration tests pass in Docker

### Learnings
- Rate limiting by email address (not IP) provides better protection for this endpoint
- The RateLimiter class has `_is_testing()` check that bypasses limits when TESTING=1
- For rate limit tests, must set TESTING=0 with `patch.dict(os.environ)` pattern

---

## 2026-01-16: US-44.2 - Email Service with SMTP2GO

### Summary
Created email service to send password reset emails using SMTP with STARTTLS.

### Files Changed
- `backend/app/config.py` - Added SMTP config settings (smtp_host, smtp_port, smtp_username, smtp_password, smtp_from_email, frontend_url)
- `backend/app/services/email.py` - New email service with send_password_reset_email() function
- `backend/tests/test_email.py` - 18 unit tests with mocked smtplib.SMTP

### Key Implementation Details
- Uses smtplib with STARTTLS for secure connection
- Sends both HTML and plain text email formats (multipart/alternative)
- Email includes: reset link (clickable), expiration time (15 minutes), user's email for reference
- Raises HTTPException 500 on SMTP errors (authentication, connection, general SMTP errors)
- Skips login if username/password are empty (for testing with local SMTP servers)
- Logs success message on email sent

### Verification
- 523 backend tests pass (18 new email tests)
- mypy typecheck passes

### Learnings
- smtplib context manager (`with`) automatically handles quit/disconnect
- MIMEMultipart("alternative") lets email clients choose HTML or plain text

---

## 2026-01-16: US-44.1 - Password Reset Token Model

### Summary
Created `PasswordResetToken` database model to store password reset tokens securely for the forgot password feature.

### Files Changed
- `backend/app/database.py` - Added `PasswordResetToken` model with all required fields
- `backend/alembic/versions/20260116_203015_*.py` - Migration to create table
- `backend/tests/test_password_reset.py` - Unit tests for model CRUD and constraints

### Key Implementation Details
- Fields: `id`, `user_id`, `token_hash`, `expires_at`, `created_at`, `used`
- `token_hash` column is indexed for fast lookup
- Foreign key to `users` table with `ON DELETE CASCADE` - tokens deleted when user is deleted
- `used` boolean flag to prevent token reuse

### Verification
- 505 backend tests pass (6 new tests for PasswordResetToken model)
- mypy typecheck passes
- 28 integration tests pass in Docker
- Table verified in Docker database with correct columns and foreign key

### Learnings
- CASCADE delete in SQLAlchemy requires `ondelete="CASCADE"` in ForeignKey definition
- SQLite in-memory tests may not enforce foreign keys (engine-specific behavior)

---

## 2026-01-16: US-33.1 - Calculate and Store Total Series Size

### Summary
Modified `calculate_season_sizes()` to also calculate and store the total series size (sum of all seasons) in `CachedMediaItem.size_bytes`. This enables the Library page to display actual series sizes instead of "Unknown size".

### Files Changed
- `backend/app/services/sync.py` - Added `total_series_size` accumulator, store in `size_bytes`
- `backend/tests/test_sync.py` - Added tests for total series size calculation

### Key Implementation Details
- `calculate_season_sizes()` now tracks both `largest_season_size` and `total_series_size`
- For each season, the season size is added to `total_series_size`
- After processing all seasons, `size_bytes` is updated with the total
- Log message now includes both total size and largest season size for debugging
- Frontend already uses `size_formatted` from API, so no frontend changes needed

### Verification
- 491 backend tests pass (added 1 new test for total series size)
- All 405 frontend tests pass
- mypy typecheck passes
- svelte-check passes
- 27 integration tests pass in Docker

### Learnings
- The `format_size()` function returns "Unknown size" when `size_bytes` is None or 0
- Once `size_bytes` is populated during sync, the Library page will automatically display proper sizes

---

## 2026-01-16: US-17.2.1 - Populate Sync Progress User Names

### Summary
Verified that sync progress user names feature was already fully implemented. No code changes needed - just marked the story as complete.

### Existing Implementation
- `backend/app/services/sync.py:456-460` - Extracts first user name in batch and passes to `update_sync_progress()`
- `frontend/src/routes/+page.svelte:159-160` - Displays "Fetching user X/Y: Name..." format

### Verification
- All 491 backend tests pass including `TestSyncProgressTracking` tests
- All 405 frontend tests pass including sync.test.ts and setup-checklist.test.ts
- Typecheck passes (mypy, svelte-check)
- Integration tests pass in Docker
- Visual verification attempted via Puppeteer (sync completes too fast to capture mid-progress)

### Key Implementation Details (Pre-existing)
- `fetch_jellyfin_media_with_progress()` processes users in batches of 3
- For each batch, it extracts the first user's display name: `first_user_name = batch_users[0].get("Name", "Unknown")`
- Passes this name to `update_sync_progress()` which stores it in `SyncStatus.current_user_name`
- API endpoint `/api/sync/status` returns the name in `progress.current_user_name`
- Frontend `formatProgressMessage()` formats: `Fetching user ${progress.current_step_progress}/${progress.current_step_total}: ${userName}...`

### Learnings
- Before implementing, always check if the feature is already complete by reviewing existing code
- The sync progress user names feature was implemented alongside the main sync progress tracking

---

## 2026-01-16: US-38.2 - Store French Titles During Sync

### Summary
Added ability to fetch and store French titles during sync, enabling future display of content in French.

### Files Changed
- `backend/app/database.py` - Added `title_fr` column to `CachedJellyseerrRequest` model
- `backend/app/services/sync.py` - Added `language` parameter to `fetch_media_details()`, added `extract_french_title_from_request()` helper, updated sync to fetch both English and French titles
- `backend/tests/test_sync.py` - Added tests for French title extraction and fetch_media_details with language
- `backend/alembic/versions/20260116_192531_*.py` - Migration for `title_fr` column

### Key Implementation Details
- `fetch_media_details()` now accepts `language` parameter (default: "en")
- During sync, the service makes two API calls per media item: one for English, one for French
- French titles are stored in `title_fr` (movies use `title_fr`, TV shows use `name_fr` from media details)
- `extract_french_title_from_request()` extracts French title from media object
- Missing French titles are stored as None (graceful degradation)
- Uses separate caches for EN and FR to avoid duplicate lookups

### Learnings
- The Jellyseerr API accepts a `language` parameter to fetch localized titles from TMDB
- Caching both languages separately prevents redundant API calls for the same TMDB ID

---

## 2026-01-16: US-38.1 - Add Title Language User Setting

### Summary
Added user setting to choose preferred language (English or French) for content titles. This is the first step toward supporting French title display.

### Files Changed
- `backend/app/database.py` - Added `title_language` column to `UserSettings` (String(2), default='en')
- `backend/app/models/settings.py` - Added `TitleLanguage` Literal type and fields to display preferences models
- `backend/app/routers/settings.py` - Updated GET/POST display endpoints to include `title_language`
- `backend/tests/test_integration.py` - Added integration tests for title_language API
- `backend/alembic/versions/20260116_191223_*.py` - Migration for `title_language` column
- `frontend/src/routes/settings/+page.svelte` - Added "Title language" dropdown to Display section

### Key Implementation Details
- TitleLanguage is a Literal type: `"en" | "fr"`
- Default value is "en" (English)
- Migration includes `server_default='en'` for existing rows
- Frontend dropdown saves on change (no save button needed)
- Includes proper loading states and error handling

### Learnings
- When adding a new NOT NULL column, always include `server_default` in migration for existing rows

---

## 2026-01-16: US-37.1 - Prefill Nicknames During Sync (Backend)

### Summary
Implemented automatic prefill of nickname records for all Jellyfin users during sync, including detection of users with Jellyseerr accounts.

### Files Changed
- `backend/app/database.py` - Added `has_jellyseerr_account` boolean field to `UserNickname` model
- `backend/app/models/settings.py` - Added `has_jellyseerr_account` to `NicknameItem` response model
- `backend/app/services/sync.py` - Added `fetch_jellyseerr_users()` and `prefill_user_nicknames()` functions
- `backend/app/services/nicknames.py` - Updated to include `has_jellyseerr_account` in list response
- `backend/app/routers/settings.py` - Updated nickname endpoints to return `has_jellyseerr_account`
- `backend/tests/test_nickname_prefill.py` - New test file for nickname prefill functionality
- `backend/tests/test_sync.py` - Updated existing tests to mock new functions
- `backend/tests/test_sync_mocked_integration.py` - Added Jellyseerr users mock
- `backend/alembic/versions/20260116_184830_*.py` - Migration for `has_jellyseerr_account` column

### Key Implementation Details
- `fetch_jellyseerr_users()` calls `/api/v1/user` endpoint and returns empty list on error (graceful degradation)
- `prefill_user_nicknames()` creates nickname records for each Jellyfin user during sync
  - Preserves existing mappings (only creates if not exists)
  - Matches Jellyfin usernames against Jellyseerr users (case-insensitive)
  - Sets `has_jellyseerr_account=True` for users found in Jellyseerr
- Display name is left empty for user to fill in later

### Learnings
- When adding new API calls to sync service, remember to update all existing sync tests to mock the new functions
- `respx` mocks require explicit routes for every HTTP call made during test

---

## 2026-01-16: US-37.3 - Manual Refresh Button for Jellyfin Users

### Summary
Added a "Refresh users" button on the Settings page that allows users to manually fetch Jellyfin users and populate the nickname list without waiting for the next sync.

### Files Changed
- `backend/app/models/settings.py` - Added `NicknameRefreshResponse` model
- `backend/app/routers/settings.py` - Added `POST /api/settings/nicknames/refresh` endpoint
- `backend/tests/test_settings.py` - Added 6 tests for refresh endpoint
- `backend/tests/test_integration.py` - Added integration test for refresh endpoint
- `frontend/src/routes/settings/+page.svelte` - Added "Refresh users" button with loading state
- `frontend/tests/settings-nicknames.test.ts` - Added 6 tests for refresh API contract

### Key Implementation Details
- Endpoint reuses existing `fetch_jellyfin_users()`, `fetch_jellyseerr_users()`, and `prefill_user_nicknames()` from sync service
- Returns 400 if Jellyfin not configured, 500 if Jellyfin API fails
- Response includes `success`, `message` (human-readable), and `new_users_count`
- Button only visible when `hasJellyfinConfigured` is true
- Shows loading spinner and disables button during refresh

### Verification
- 498 backend tests pass (6 new tests)
- 411 frontend tests pass (6 new tests)
- 28 integration tests pass (1 new test)
- mypy typecheck passes
- svelte-check passes

### Learnings
- Can reuse sync service functions in settings router by importing from `app.services.sync`
- Import `Any` from typing when using `dict[str, Any]` type hints

---

## 2025-01-16: US-28.1 - Loading States Accessibility

### Summary
Added accessibility attributes to loading states across all main pages so screen readers can announce loading status and content updates.

### Files Changed
- `frontend/src/routes/+page.svelte` - Dashboard with aria-busy, aria-live on stats grid
- `frontend/src/routes/issues/+page.svelte` - Issues page with aria-busy, aria-live on table
- `frontend/src/routes/settings/+page.svelte` - Settings page with aria-busy, role="status" on loading
- `frontend/src/routes/library/+page.svelte` - Library page with aria-busy, aria-live on table
- `frontend/src/routes/whitelist/+page.svelte` - Whitelist page with aria-busy, aria-live on list
- `frontend/src/routes/info/recent/+page.svelte` - Recent page with aria-busy, aria-live on table

### Key Implementation Details
- `aria-busy="true/false"` on parent containers (dashboard, issues-page, settings-page, library-page, whitelist-page, page) - dynamically set based on loading state
- `role="status"` and `aria-label="Loading..."` on loading div elements
- `aria-hidden="true"` on spinner elements (decorative)
- `aria-live="polite"` on table/list containers that update with content
- `aria-live="assertive"` on toast notifications

### Verification
- 523 backend tests pass
- 411 frontend tests pass
- svelte-check passes (0 errors)
- Verified in browser using Puppeteer - all aria attributes present

### Learnings
- `aria-busy` should be on the container that changes during load (toggles between content and loading state)
- `aria-live="polite"` announces updates without interrupting the user
- `aria-live="assertive"` for urgent messages like error toasts
- Spinners should have `aria-hidden="true"` since the `role="status"` on parent provides context

---

## 2026-01-18: US-35.2 - Display Last Watched Date for Series

### Summary
Fixed series showing "Watched" instead of actual last watched date. Jellyfin tracks watch data at the episode level, not the series level. Modified the sync process to fetch episode UserData from all Jellyfin users and aggregate the most recent LastPlayedDate.

### Files Changed
- `backend/app/services/sync.py` - Added get_most_recent_episode_played_date(), modified fetch_season_episodes() and calculate_season_sizes()
- `backend/tests/test_sync.py` - Added 6 new tests for get_most_recent_episode_played_date(), updated existing tests with mock for fetch_jellyfin_users

### Key Implementation Details
- `fetch_season_episodes()` now accepts optional `jellyfin_user_id` parameter and includes `UserData` in API request
- `calculate_season_sizes()` fetches all Jellyfin users, then for each season fetches episode UserData for each user
- `get_most_recent_episode_played_date()` iterates through all episodes and returns the most recent LastPlayedDate
- Frontend `formatLastWatched()` already displays dates correctly when data is present

### Root Cause Analysis
- Jellyfin API returns `UserData.LastPlayedDate` at the episode level, not series level
- Series items have `played=True` but `LastPlayedDate=None` in the API response
- Previous sync only stored the series-level UserData which lacked the date

### Verification
- 97 sync tests pass (6 new tests for get_most_recent_episode_played_date)
- mypy typecheck passes (32 source files)
- Manual testing requires a full sync to populate episode watch data

### Learnings
- Jellyfin stores watch data per-episode, aggregated data must be computed
- When adding new dependencies in functions, update existing test mocks accordingly
- Consider API rate limiting when making additional calls during sync

---

## 2026-01-18: US-36.1 - Settings Layout with Sidebar Navigation

### Summary
Created a new settings layout with sidebar navigation, breadcrumb, and placeholder sub-pages. The settings page now redirects to /settings/connections by default, with navigation to Connections, Thresholds, Users, and Display sections.

### Files Changed
- `frontend/src/routes/settings/+layout.svelte` - New layout with sidebar navigation and breadcrumb
- `frontend/src/routes/settings/+page.server.ts` - Server-side redirect to /settings/connections
- `frontend/src/routes/settings/+page.svelte` - Deleted (content will be extracted to sub-pages)
- `frontend/src/routes/settings/connections/+page.svelte` - Placeholder page for connections
- `frontend/src/routes/settings/thresholds/+page.svelte` - Placeholder page for thresholds
- `frontend/src/routes/settings/users/+page.svelte` - Placeholder page for users
- `frontend/src/routes/settings/display/+page.svelte` - Placeholder page for display
- `frontend/e2e/settings.spec.ts` - Updated E2E tests for new layout
- `frontend/e2e/auth-flow.spec.ts` - Updated to expect /settings/connections redirect
- `frontend/e2e/header.spec.ts` - Updated to expect /settings/connections redirect

### Key Implementation Details
- Layout uses flexbox with sidebar on left, content on right
- Breadcrumb shows: Dashboard > Settings > [Section Name]
- Active nav item highlighted with accent background color
- Server-side redirect using `throw redirect(307, '/settings/connections')`
- Responsive: @media (max-width: 768px) changes sidebar to horizontal scrollable tabs
- Icons for each nav item (plug, sliders, users, monitor) using inline SVG

### Verification
- 423 frontend unit tests pass
- svelte-check passes (0 errors, 3 warnings)
- 23 E2E tests pass
- Verified in browser: sidebar navigation works, redirect works, mobile responsive

### Learnings
- SvelteKit redirects must use `throw redirect()` not just `redirect()`
- New route directories require Docker rebuild to be picked up (HMR doesn't detect new folders)
- E2E tests that create users can hit rate limits when run in parallel

---

## 2026-01-18: US-36.2 - Extract Connections Page

### Summary
Extracted the API connections section from the deleted settings page into a dedicated `/settings/connections/+page.svelte` page. This is the first of four extraction stories (US-36.2 through US-36.5) to complete the settings page refactoring.

### Files Changed
- `frontend/src/routes/settings/connections/+page.svelte` - Full implementation of connections page
- `frontend/tests/settings-connections.test.ts` - New test file with 15 API contract tests

### Key Implementation Details
- All four service connection forms: Jellyfin, Jellyseerr, Radarr, Sonarr
- Each service has expand/collapse functionality with Edit/Cancel button
- Status indicators: green dot for connected, gray dot for not connected
- Domain extraction shows hostname instead of full URL (e.g., "jellyfin.example.com")
- Form shows "(leave blank to keep)" hint for API key when editing existing connection
- Auto-expand forms for unconfigured services (Jellyfin, Jellyseerr only)
- Auto-sync after first Jellyfin configuration if user has never synced
- Loading state with spinner during initial fetch
- Inline success/error messages for each form
- Responsive design: form fields stack vertically on mobile

### Verification
- 438 frontend unit tests pass (15 new tests)
- svelte-check passes (0 errors, 3 warnings)
- Verified in Docker: all connection forms load, expand, and display correctly
- Verified: status dots show correct colors based on configuration state

### Learnings
- The old settings page was deleted in US-36.1, but git history preserves the original code
- Code extraction from git history: `git show COMMIT^:path/to/file`
- Each settings sub-page manages its own state independently (no shared state between pages)

---

## 2026-01-18: US-36.3 - Extract Thresholds Page

### Summary
Extracted the analysis thresholds section from the deleted settings page into a dedicated `/settings/thresholds/+page.svelte` page. This is the second of four extraction stories to complete the settings page refactoring.

### Files Changed
- `frontend/src/routes/settings/thresholds/+page.svelte` - Full implementation of thresholds page
- `frontend/tests/settings-thresholds.test.ts` - New test file with 15 API contract tests

### Key Implementation Details
- Four threshold inputs: Old content months, Min age months, Large movie size, Large season size
- Help text shows which feature uses each threshold (e.g., "Used by: Old tab")
- Save button submits all values via POST /api/settings/analysis
- Reset button calls DELETE /api/settings/analysis to restore defaults
- Loading state with spinner during initial fetch
- Inline success/error messages
- Responsive: threshold rows stack vertically on mobile (≤600px)
- Default values: 4 months, 3 months, 13 GB, 15 GB

### Verification
- 453 frontend unit tests pass (15 new tests)
- svelte-check passes (0 errors, 3 warnings)
- Verified in Docker: page loads, Save works, Reset works
- Verified: changed value from 4 to 6, then Reset restored to 4

### Learnings
- Thresholds section already had a dedicated API endpoint (GET/POST/DELETE /api/settings/analysis)
- Old settings page was deleted in US-36.1; code extracted from git history
- Svelte 5 uses $state() for reactive state instead of let

---

## 2026-01-18: US-36.4 - Extract Users Page

### Summary
Extracted the user nicknames section from the deleted settings page into a dedicated `/settings/users/+page.svelte` page. This is the third of four extraction stories to complete the settings page refactoring.

### Files Changed
- `frontend/src/routes/settings/users/+page.svelte` - Full implementation of users/nicknames page
- `frontend/tests/settings-users.test.ts` - New test file with 16 API contract tests

### Key Implementation Details
- Table displays existing mappings: Jellyseerr Username → Display Name
- Warning badge (!) for users with `has_jellyseerr_account=false` (Jellyfin users not found in Jellyseerr)
- Edit mode: inline input field with Save/Cancel buttons
- Delete confirmation: inline "Delete this nickname?" with Confirm/Cancel buttons
- Empty state with "Add nickname" call-to-action button
- "Refresh users" button (only when Jellyfin configured) fetches Jellyfin users to populate list
- Toast feedback on all CRUD operations
- Responsive: table scrolls horizontally on mobile, header stacks vertically

### Verification
- 469 frontend unit tests pass (16 new tests)
- svelte-check passes (0 errors, 3 warnings)
- Verified in Docker: table loads, edit mode works, delete confirmation works
- Verified: warning badges display for users without Jellyseerr accounts

### Learnings
- Old settings page was deleted in US-36.1; code extracted from git history using `git show`
- The `has_jellyseerr_account` field was added in US-37.1 to mark users found in both Jellyfin and Jellyseerr
- Empty display names show "—" (em dash) instead of blank for visual clarity

---

## 2026-01-18: US-36.5 - Extract Display Page

### Summary
Extracted the display preferences section from the deleted settings page into a dedicated `/settings/display/+page.svelte` page. This is the final extraction story in the settings page refactoring series (US-36.1 through US-36.5).

### Files Changed
- `frontend/src/routes/settings/display/+page.svelte` - Full implementation of display settings page
- `frontend/tests/settings-display-page.test.ts` - New test file with 18 API contract tests

### Key Implementation Details
- Theme selector (Light/Dark/System) - changes apply immediately via theme store
- Title language dropdown (English/French) - saves on change
- Recently available days input (1-30 range) - saves on change
- Show unreleased requests toggle - saves on change
- Each setting calls POST /api/settings/display with a partial update (single field)
- Loading state with spinner during initial fetch
- Saving indicator shows when any setting is being saved
- Responsive: setting rows stack vertically on mobile (≤600px)

### Verification
- 487 frontend unit tests pass (18 new tests)
- svelte-check passes (0 errors, 3 warnings - all pre-existing)
- Verified in Docker: all display settings load, change, and persist correctly
- Theme changes apply immediately to the UI

### Learnings
- The old settings page was deleted in US-36.1; this completes the extraction series
- Using partial updates (one field per POST) simplifies the save logic and provides instant feedback
- The theme store already had `setPreference()` method to apply theme changes to the DOM

---

## 2026-01-18: US-39.1 - Add Manual Dismiss Button to Toasts

### Summary
Added manual dismiss button to all toast notifications with keyboard accessibility and ARIA labels.

### Files Changed
- `frontend/src/lib/components/Toast.svelte` - New reusable Toast component with close button
- `frontend/tests/toast.test.ts` - 28 new unit tests for Toast component
- `frontend/src/routes/+page.svelte` - Updated to use Toast component
- `frontend/src/routes/issues/+page.svelte` - Updated to use Toast component
- `frontend/src/routes/whitelist/+page.svelte` - Updated to use Toast component
- `frontend/src/routes/info/recent/+page.svelte` - Updated to use Toast component
- `frontend/src/routes/content/old-unwatched/+page.svelte` - Updated to use Toast component

### Key Implementation Details
- Toast.svelte component with X close button in top-right corner
- Keyboard accessible: Tab to focus, Enter/Space to activate close
- aria-label="Close notification" for screen reader accessibility
- SVG X icon with aria-hidden="true" (decorative)
- Close button has hover/focus styles for visual feedback
- Each page tracks toastTimer to clear on manual close
- Auto-dismiss after 3 seconds still works if not manually closed
- Supports success, error, and info toast types

### Verification
- 521 frontend unit tests pass (28 new tests)
- svelte-check passes (0 errors, 3 warnings - all pre-existing)
- Docker build succeeds
- Toast component renders correctly in browser

---

## Notes

- US-0.2 (Dockerize) was completed together with US-0.1 since Docker setup was needed for testing
- Backend runs on port 8080 (mapped from 8000), Frontend on port 5173
- API proxy configured in vite.config.ts for dev environment
- Production: https://mediajanitor.com with HTTPS via Let's Encrypt
- CI/CD: Push to main triggers auto-deploy to VPS
