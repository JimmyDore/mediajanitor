{
  "project": "Media Janitor",
  "branchName": "ralph/ux-and-delete-fixes",
  "userStories": [
    {
      "id": "US-15.10",
      "title": "Lookup Jellyseerr Request by TMDB ID When Deleting",
      "story": "As a media server owner, I want Jellyseerr requests to be deleted when I delete content from any tab, so that I don't have orphaned requests after deleting movies/series",
      "acceptanceCriteria": [
        "Backend looks up Jellyseerr request by TMDB ID + media_type from cached_jellyseerr_requests table",
        "Lookup only happens when delete_from_jellyseerr=true AND no jellyseerr_request_id provided",
        "If user unchecked 'Delete from Jellyseerr' in modal, no lookup or deletion occurs",
        "If matching request found, delete it from Jellyseerr",
        "If no matching request exists, skip gracefully (not an error)",
        "Response message indicates whether Jellyseerr request was found and deleted",
        "Typecheck passes",
        "Unit tests pass"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Implemented _lookup_jellyseerr_request_by_tmdb() helper function. Both delete_movie and delete_series endpoints now look up Jellyseerr request by TMDB ID when no explicit request ID is provided. 5 new unit tests added."
    },
    {
      "id": "US-12.1",
      "title": "Add Threshold Help Text",
      "story": "As a user, I want to understand what each threshold setting does, so that I can configure them correctly",
      "acceptanceCriteria": [
        "\"Flag content unwatched for\" shows help text: \"Used by: Old tab\"",
        "\"Don't flag content newer than\" shows help text: \"Used by: Old tab (for never-watched items)\"",
        "\"Flag movies larger than\" shows help text: \"Used by: Large tab\"",
        "Help text appears in subtle gray below each input",
        "Typecheck passes",
        "Unit tests pass",
        "Verify in browser using browser tools"
      ],
      "priority": 10,
      "passes": true,
      "notes": "Added threshold-label-group wrapper and threshold-help class for subtle gray help text below each threshold input."
    },
    {
      "id": "US-12.2",
      "title": "Remove Multi-Issue Tab",
      "story": "As a user, I want a simpler Issues page, so that I'm not confused by extra filters",
      "acceptanceCriteria": [
        "Multi-Issue tab removed from Issues page filter tabs",
        "URL parameter ?filter=multi no longer supported (returns all issues or 400)",
        "Backend API documentation updated to remove 'multi' filter option",
        "Typecheck passes",
        "Unit tests pass",
        "Verify in browser: only 5 tabs remain (All, Old, Large, Language, Requests)"
      ],
      "priority": 11,
      "passes": false,
      "notes": "Files: frontend/src/routes/issues/+page.svelte, backend/app/routers/content.py, backend/app/services/content.py"
    },
    {
      "id": "US-12.3",
      "title": "Fix TMDB Link Media Type",
      "story": "As a user, I want TMDB links to work correctly, so that I can check content details on TMDB",
      "acceptanceCriteria": [
        "TMDB links work for Movies (link to /movie/{id})",
        "TMDB links work for TV Shows (link to /tv/{id})",
        "Handle both uppercase (\"Movie\", \"Series\") and lowercase (\"movie\", \"tv\") media types",
        "Typecheck passes",
        "Unit tests pass",
        "Verify in browser: click TMDB link on Requests tab -> correct page opens"
      ],
      "priority": 12,
      "passes": false,
      "notes": "Root cause: getTmdbUrl() checks item.media_type === 'Movie' but request items use lowercase 'movie'. File: frontend/src/routes/issues/+page.svelte"
    },
    {
      "id": "US-12.5",
      "title": "External Links for All Issue Types",
      "story": "As a user, I want TMDB/IMDb links on all content items, so that I can easily look up any flagged content",
      "acceptanceCriteria": [
        "Old tab items show TMDB/IMDb links (where data exists)",
        "Large tab items show TMDB/IMDb links (where data exists)",
        "Language tab items show TMDB/IMDb links (where data exists)",
        "Requests tab items show TMDB/IMDb links (already implemented, just needs fix from US-12.3)",
        "External link icon appears next to title if TMDB or IMDb ID available",
        "Typecheck passes",
        "Unit tests pass",
        "Verify in browser: external links appear on items in all tabs"
      ],
      "priority": 13,
      "passes": false,
      "notes": "Backend already extracts TMDB/IMDb IDs via extract_provider_ids(). File: frontend/src/routes/issues/+page.svelte"
    },
    {
      "id": "US-12.6",
      "title": "Fix Watch Status Display",
      "story": "As a user, I want to see accurate watch status for content items, so that I can make informed decisions about what to delete",
      "acceptanceCriteria": [
        "Items that have been watched show relative date (e.g., '3mo ago') or 'Watched' if no date",
        "Items never watched show 'Never'",
        "Backend returns 'played' boolean in ContentIssueItem response",
        "Frontend uses both 'played' and 'last_played_date' to determine display",
        "Typecheck passes",
        "Unit tests pass",
        "Verify in browser: watched items no longer show 'Never'"
      ],
      "priority": 14,
      "passes": false,
      "notes": "Root cause: ContentIssueItem model missing 'played' boolean field. Files: backend/app/models/content.py, backend/app/services/content.py, frontend/src/routes/issues/+page.svelte"
    },
    {
      "id": "US-15.1",
      "title": "Fix Hidden Requests Showing TMDB IDs",
      "story": "As a user, I want hidden requests to show actual movie/show titles, so that I can identify what content I've hidden",
      "acceptanceCriteria": [
        "Hidden Requests tab shows actual titles, not \"TMDB-123456\"",
        "Backend looks up title from CachedJellyseerrRequest table when whitelisting",
        "Typecheck passes",
        "Unit tests pass",
        "Verify in browser using browser tools"
      ],
      "priority": 20,
      "passes": false,
      "notes": "Root Cause: Frontend passes item.name which may be the fallback TMDB-{id} string. Files: backend/app/routers/whitelist.py, backend/app/services/content.py"
    },
    {
      "id": "US-15.8",
      "title": "Fix Auth Check Loading Delay",
      "story": "As a user, I want public pages to load instantly, so that I don't see a loading spinner on landing/login/register pages",
      "acceptanceCriteria": [
        "Landing page (/) renders immediately without loading state",
        "Login page (/login) renders immediately without loading state",
        "Register page (/register) renders immediately without loading state",
        "Protected routes still show loading while auth check runs",
        "Typecheck passes",
        "Unit tests pass",
        "Verify in browser using browser tools"
      ],
      "priority": 21,
      "passes": false,
      "notes": "Root Cause: Layout shows loading for ALL routes. Should only show loading on protected routes. File: frontend/src/routes/+layout.svelte"
    },
    {
      "id": "US-15.9",
      "title": "Remove Unused api.ts File",
      "story": "As a developer, I want unused code removed, so that the codebase is clean and maintainable",
      "acceptanceCriteria": [
        "frontend/src/lib/api.ts file deleted",
        "No import errors after deletion",
        "Typecheck passes",
        "Unit tests pass"
      ],
      "priority": 22,
      "passes": false,
      "notes": "Unused exports: contentApi, languageApi, requestsApi, whitelistApi, settingsApi, healthApi. File: frontend/src/lib/api.ts"
    },
    {
      "id": "US-16.1",
      "title": "Theme Preference Backend",
      "story": "As a developer, I want a backend endpoint to store theme preference, so that the frontend can persist user's theme choice",
      "acceptanceCriteria": [
        "Add theme_preference column to UserSettings model (enum: light, dark, system)",
        "Default value is 'system' (follow OS preference)",
        "Create Alembic migration for the new column",
        "GET /api/settings/display includes theme_preference field",
        "POST /api/settings/display accepts theme_preference field",
        "Typecheck passes",
        "Unit tests pass"
      ],
      "priority": 50,
      "passes": false,
      "notes": "Files: backend/app/database.py, backend/app/models/settings.py, backend/app/routers/settings.py, backend/alembic/versions/"
    },
    {
      "id": "US-16.2",
      "title": "Theme Store and Application",
      "story": "As a user, I want my theme choice to be applied across the app, so that I see consistent light/dark styling",
      "acceptanceCriteria": [
        "Create theme store that reads user preference from API",
        "Apply theme via data-theme attribute on <html> element",
        "data-theme='light' forces light mode",
        "data-theme='dark' forces dark mode",
        "data-theme='system' (or no attribute) follows OS preference",
        "Theme persists across page navigation",
        "Theme loads correctly on page refresh",
        "Typecheck passes",
        "Unit tests pass"
      ],
      "priority": 51,
      "passes": false,
      "notes": "Files: frontend/src/lib/stores/theme.ts, frontend/src/app.css, frontend/src/routes/+layout.svelte"
    },
    {
      "id": "US-16.3",
      "title": "Theme Toggle UI in Settings",
      "story": "As a user, I want a theme selector in settings, so that I can choose between light, dark, or system preference",
      "acceptanceCriteria": [
        "Settings page Display section has theme selector",
        "Three options: Light, Dark, System (default)",
        "Selector shows current preference",
        "Changing selection immediately updates the theme",
        "Saves preference to backend on change",
        "Toast notification on success/error",
        "Typecheck passes",
        "Unit tests pass",
        "Verify in browser using browser tools"
      ],
      "priority": 52,
      "passes": false,
      "notes": "File: frontend/src/routes/settings/+page.svelte"
    }
  ]
}
